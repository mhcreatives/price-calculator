<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invitation Price Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #ffffff; color: #333333; line-height: 1.5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 10px 20px; background-color: #f5f5f5; border-bottom: 1px solid #e0e0e0; margin-bottom: 20px; }
        h1 { font-size: 1.5rem; color: #333333; font-weight: 400; }
        .calculator-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        @media (max-width: 900px) { .calculator-wrapper { grid-template-columns: 1fr; } }
        .options-panel, .result-panel { background-color: white; border: 1px solid #e0e0e0; padding: 20px; }
        .result-panel { display: flex; flex-direction: column; }
        .section-title { font-size: 1.1rem; color: #333333; margin-bottom: 15px; padding-bottom: 6px; border-bottom: 1px solid #e0e0e0; font-weight: 500; }
        .option-group { margin-bottom: 20px; }
        .option-label { display: block; font-weight: 500; margin-bottom: 8px; color: #333333; font-size: 0.95rem; }
        .option-grid, .event-option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .event-option-grid { grid-template-columns: repeat(5, 1fr); }
        @media (max-width: 768px) { .event-option-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 480px) { .event-option-grid { grid-template-columns: 1fr 1fr; } }
        .option-card { border: 1px solid #cccccc; border-radius: 4px; padding: 10px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; text-align: center; background-color: #ffffff; }
        .option-card:hover { border-color: #666666; background-color: #f9f9f9; }
        .option-card.selected { border-color: #333333; background-color: #f0f0f0; font-weight: 500; }
        .option-name { color: #333333; font-size: 0.85rem; }
        .slider-container { padding: 0 10px; }
        .slider-value { text-align: center; font-weight: 500; margin-top: 6px; color: #333333; font-size: 0.95rem; }
        input[type="range"] { width: 100%; height: 6px; border-radius: 3px; background: #e0e0e0; outline: none; -webkit-appearance: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: #333333; cursor: pointer; border: 1px solid #cccccc; }
        .input-group { margin-bottom: 15px; }
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .input-label { display: block; font-weight: 500; margin-bottom: 6px; color: #333333; font-size: 0.95rem; }
        .text-input, .date-input, .select-input { width: 100%; padding: 8px; border: 1px solid #cccccc; border-radius: 4px; font-size: 0.95rem; background-color: #ffffff; }
        .text-input:focus, .date-input:focus, .select-input:focus { outline: none; border-color: #666666; }
        .layout-rush-section { margin: 15px 0; }
        .layout-rush-row { display: grid; grid-template-columns: auto 1fr; gap: 10px; align-items: center; margin-bottom: 10px; padding: 10px; background-color: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 4px; }
        .layout-rush-checkbox { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; }
        .layout-rush-checkbox input { margin: 0; }
        .addon-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .addon-item { display: flex; flex-direction: column; padding: 10px; border: 1px solid #e0e0e0; border-radius: 4px; background-color: #f9f9f9; height: 100%; }
        .addon-header { display: flex; align-items: flex-start; margin-bottom: 8px; }
        .addon-checkbox { margin-right: 10px; margin-top: 2px; }
        .addon-name { font-weight: 500; color: #333333; font-size: 0.9rem; }
        .addon-option { display: flex; align-items: center; margin-top: 5px; font-size: 0.85rem; color: #666666; }
        .addon-input { width: 70px; padding: 4px 6px; border: 1px solid #cccccc; border-radius: 3px; margin-left: 8px; font-size: 0.85rem; text-align: center; }
        .addon-input:disabled { background-color: #f0f0f0; color: #999999; cursor: not-allowed; }
        .button-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 15px; }
        .action-button { background-color: #f0f0f0; color: #333333; border: 1px solid #cccccc; padding: 8px; font-size: 0.85rem; border-radius: 4px; cursor: pointer; transition: background-color 0.2s; font-weight: 500; height: 40px; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .action-button:hover { background-color: #e5e5e5; border-color: #999999; }
        .copy-button { background-color: #333333; color: white; border: 1px solid #333333; width: 100%; margin-top: 15px; padding: 10px; height: 44px; font-size: 0.9rem; }
        .copy-button:hover { background-color: #444444; }
        .summary-container { flex-grow: 1; }
        .event-type-title { font-size: 1.2rem; font-weight: 500; color: #333333; margin-bottom: 8px; text-align: center; }
        .event-date-line { color: #666666; font-size: 0.95rem; text-align: center; margin-bottom: 20px; }
        .price-per-set { font-size: 2.2rem; font-weight: 300; color: #333333; margin-bottom: 20px; text-align: center; line-height: 1; }
        .summary-details { margin-bottom: 20px; padding: 15px; background-color: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 4px; }
        .summary-line { margin-bottom: 8px; font-size: 0.95rem; line-height: 1.4; }
        .addons-summary { margin-top: 10px; }
        .sets-total { margin-top: 20px; padding-top: 15px; border-top: 1px solid #cccccc; font-weight: 600; font-size: 1.1rem; text-align: center; color: #333333; }
        .one-time-fees { margin-top: 10px; padding-top: 10px; border-top: 1px dashed #cccccc; }
        .final-total { margin-top: 20px; padding-top: 15px; border-top: 2px solid #333333; font-weight: 600; font-size: 1.3rem; text-align: center; color: #333333; }
        footer { text-align: center; margin-top: 25px; padding-top: 12px; border-top: 1px solid #e0e0e0; color: #666666; font-size: 0.8rem; }
        .notification { position: fixed; top: 20px; right: 20px; background-color: #333333; color: white; padding: 10px 16px; border-radius: 4px; font-size: 0.85rem; opacity: 0; transform: translateY(-10px); transition: opacity 0.3s, transform 0.3s; z-index: 1000; }
        .notification.show { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>
    <div class="container">
        <header><h1>Invitation Price Calculator</h1></header>
        <div class="calculator-wrapper">
            <div class="options-panel">
                <h2 class="section-title">Customization Options</h2>
                <div class="option-group">
                    <label class="option-label">1. Event Type</label>
                    <div class="event-option-grid" id="event-type-options">
                        <div class="option-card selected" data-value="wedding" data-price="0"><div class="option-name">Wedding</div></div>
                        <div class="option-card" data-value="debut" data-price="0"><div class="option-name">Debut</div></div>
                        <div class="option-card" data-value="birthday" data-price="0"><div class="option-name">Birthday</div></div>
                        <div class="option-card" data-value="baptism" data-price="0"><div class="option-name">Baptism</div></div>
                        <div class="option-card" data-value="special-event" data-price="0"><div class="option-name">Special event</div></div>
                    </div>
                </div>
                <div class="option-group"><label class="option-label">2. Size</label>
                    <div class="option-grid" id="size-options">
                        <div class="option-card selected" data-value="4r" data-price="0"><div class="option-name">4R</div></div>
                        <div class="option-card" data-value="5r" data-price="10"><div class="option-name">5R</div></div>
                    </div>
                </div>
                <div class="option-group"><label class="option-label">3. Envelope Type</label>
                    <div class="option-grid" id="envelope-options">
                        <div class="option-card" data-value="no-envelope" data-price="-5"><div class="option-name">No envelope</div></div>
                        <div class="option-card selected" data-value="plain-white" data-price="0"><div class="option-name">Plain white</div></div>
                        <div class="option-card" data-value="colored" data-price="15"><div class="option-name">Colored</div></div>
                        <div class="option-card" data-value="transparent" data-price="15"><div class="option-name">Transparent</div></div>
                        <div class="option-card" data-value="premium-colored" data-price="20"><div class="option-name">Premium colored</div></div>
                        <div class="option-card" data-value="vellum-cover" data-price="20"><div class="option-name">Vellum cover</div></div>
                        <div class="option-card" data-value="gatefold" data-price="40"><div class="option-name">Gatefold</div></div>
                        <div class="option-card" data-value="pocket-cover" data-price="25"><div class="option-name">Pocket Cover</div></div>
                        <div class="option-card" data-value="pouch-cover" data-price="55"><div class="option-name">Pouch Cover</div></div>
                        <div class="option-card" data-value="trifold" data-price="45"><div class="option-name">Trifold</div></div>
                        <div class="option-card" data-value="vellum-cover-print" data-price="30"><div class="option-name">Vellum cover with print</div></div>
                        <div class="option-card" data-value="portrait-colored" data-price="35"><div class="option-name">Portrait colored</div></div>
                        <div class="option-card" data-value="premium-portrait-colored" data-price="45"><div class="option-name">Premium portrait colored</div></div>
                    </div>
                </div>
                <div class="option-group"><label class="option-label">4. Number of Inserts</label>
                    <div class="slider-container"><input type="range" id="inserts-slider" min="0" max="10" value="0" step="1"><div class="slider-value" id="inserts-value">0 inserts</div></div>
                </div>
                <div class="option-group"><label class="option-label">5. Paper Type</label>
                    <div class="option-grid" id="paper-options">
                        <div class="option-card selected" data-value="matte" data-price="0"><div class="option-name">Matte</div></div>
                        <div class="option-card" data-value="glossy" data-price="0"><div class="option-name">Glossy</div></div>
                        <div class="option-card" data-value="premium-matte" data-price="5"><div class="option-name">Premium matte</div></div>
                        <div class="option-card" data-value="matte-textured" data-price="5"><div class="option-name">Matte textured</div></div>
                        <div class="option-card" data-value="glossy-textured" data-price="5"><div class="option-name">Glossy textured</div></div>
                    </div>
                </div>
                <div class="option-group"><label class="option-label">6. Envelope Seal</label>
                    <div class="option-grid" id="seal-options">
                        <div class="option-card selected" data-value="no-seal" data-price="0"><div class="option-name">No seal</div></div>
                        <div class="option-card" data-value="sticker-seal" data-price="0"><div class="option-name">Sticker seal</div></div>
                        <div class="option-card" data-value="wax-seal" data-price="5"><div class="option-name">Wax seal</div></div>
                        <div class="option-card" data-value="belt" data-price="5"><div class="option-name">Belt</div></div>
                        <div class="option-card" data-value="wax-seal-string" data-price="10"><div class="option-name">Wax seal with string</div></div>
                        <div class="option-card" data-value="belt-print" data-price="10"><div class="option-name">Belt with print</div></div>
                        <div class="option-card" data-value="frosted-belt" data-price="10"><div class="option-name">Frosted belt</div></div>
                        <div class="option-card" data-value="ribbon" data-price="10"><div class="option-name">Ribbon</div></div>
                        <div class="option-card" data-value="wax-seal-flower" data-price="15"><div class="option-name">Wax seal with flower</div></div>
                        <div class="option-card" data-value="frosted-belt-print" data-price="15"><div class="option-name">Frosted belt with print</div></div>
                        <div class="option-card" data-value="frayed-ribbon" data-price="15"><div class="option-name">Frayed ribbon</div></div>
                        <div class="option-card" data-value="wax-seal-string-flower" data-price="20"><div class="option-name">Wax seal with string and flower</div></div>
                    </div>
                </div>
                
                <!-- Add-ons Section -->
                <div class="option-group">
                    <label class="option-label">7. Add-ons</label>
                    <div class="addon-grid" id="addons-grid">
                        <!-- Add-ons will be added here by JavaScript -->
                    </div>
                </div>
                
                <div class="layout-rush-section">
                    <label class="option-label">Layout Selection</label>
                    <div class="layout-rush-row">
                        <div class="layout-rush-checkbox"><input type="checkbox" id="layout-checkbox"><label for="layout-checkbox">Layout Required</label></div>
                        <select class="select-input" id="layout-type">
                            <option value="no-layout">No layout</option>
                            <option value="own-layout">Own layout</option>
                        </select>
                    </div>
                    <label class="option-label">Rush Fee</label>
                    <div class="layout-rush-row">
                        <div class="layout-rush-checkbox"><input type="checkbox" id="rush-checkbox"><label for="rush-checkbox">Rush Order</label></div>
                        <select class="select-input" id="rush-type">
                            <option value="no-layout">No layout</option>
                            <option value="own-layout">Own layout</option>
                        </select>
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group"><label class="input-label">Number of Sets</label><input type="number" class="text-input" id="sets-input" min="1" max="1000" value="20"></div>
                    <div class="input-group"><label class="input-label">Event Date</label><input type="date" class="date-input" id="event-date-input"></div>
                </div>
                <div class="button-row">
                    <button class="action-button reset-button" id="reset-button"><i class="fas fa-redo-alt"></i> Reset All</button>
                    <button class="action-button" id="print-button"><i class="fas fa-print"></i> Print</button>
                </div>
            </div>
            <div class="result-panel">
                <div class="summary-container">
                    <h2 class="section-title">Quotation Summary</h2>
                    <div class="event-type-title" id="event-type-title">Wedding invitation</div>
                    <div class="event-date-line" id="event-date-display">Event Date: Not specified</div>
                    <div class="price-per-set" id="price-per-set">₱25 each</div>
                    <div class="summary-details">
                        <div class="summary-line" id="summary-size-line">4R size</div>
                        <div class="summary-line" id="summary-envelope-line">Plain white Envelope</div>
                        <div class="summary-line" id="summary-inserts-line">0 inserts</div>
                        <div class="summary-line" id="summary-paper-line">Matte paper</div>
                        <div class="summary-line" id="summary-seal-line">No seal</div>
                        <div class="addons-summary" id="addons-summary"></div>
                        <div class="sets-total" id="sets-total">20 sets x ₱25 each = ₱500</div>
                        <div class="one-time-fees" id="one-time-fees"></div>
                    </div>
                    <div class="final-total" id="final-total">Total: ₱500</div>
                    <button class="copy-button" id="copy-button"><i class="fas fa-copy"></i> Copy Quotation Summary</button>
                </div>
            </div>
        </div>
        <footer>
            <p>Invitation Price Calculator &copy; <span id="current-year">2023</span> | All prices are per invitation set in Philippine Peso</p>
            <p>Note: Additional charges may apply for rush orders, special printing techniques, or custom artwork.</p>
        </footer>
    </div>
    <div class="notification" id="notification">Quotation copied to clipboard!</div>
    <script>
        const BASE_PRICE = 25;
        const INSERT_PRICE = 5;
        let currentSelections = {
            eventType: { value: "wedding", price: 0, name: "Wedding" },
            size: { value: "4r", price: 0, name: "4R" },
            envelope: { value: "plain-white", price: 0, name: "Plain white" },
            inserts: { value: 0, price: 0 },
            paper: { value: "matte", price: 0, name: "Matte" },
            seal: { value: "no-seal", price: 0, name: "No seal" },
            layout: { required: false, type: "no-layout", pages: 1 },
            rush: { required: false, type: "no-layout" },
            addons: {}
        };
        let numberOfSets = 20;
        let eventDate = "";
        
        // Add-ons data with pricing information
        const addonsData = [
            { id: 'map-layout', name: 'Map layout', price: 200, unit: 'flat' },
            { id: 'transparent-insert', name: 'Transparent insert', price: 30, unit: 'page' },
            { id: 'acrylic-insert', name: 'Acrylic insert', price: 80, unit: 'page' },
            { id: 'deckled-edge-cut', name: 'Deckled edge cut', price: 5, unit: 'page' },
            { id: 'custom-cut', name: 'Custom cut', price: 10, unit: 'page' },
            { id: 'photo-print', name: 'Photo print', price: 5, unit: 'page' },
            { id: 'solid-color-print', name: 'Solid color print', price: 5, unit: 'page' },
            { id: 'vellum-jacket', name: 'Vellum jacket', price: 25, unit: 'flat' },
            { id: 'vellum-jacket-print', name: 'Vellum jacket with print', price: 35, unit: 'flat' },
            { id: 'frosted-insert', name: 'Frosted insert', price: 15, unit: 'page' },
            { id: 'different-sized-insert', name: 'Different sized insert', price: 5, unit: 'flat' },
            { id: 'back-to-back-print', name: 'Back to back print', price: 5, unit: 'page' },
            { id: 'ribbon-addon', name: 'Ribbon', price: 10, unit: 'flat' },
            { id: 'sticker-seal-addon', name: 'Sticker seal', price: 3, unit: 'piece' },
            { id: 'eyelet', name: 'Eyelet', price: 10, unit: 'piece' },
            { id: 'glossy-phototop', name: 'Glossy phototop', price: 20, unit: 'page' },
            { id: 'matte-phototop', name: 'Matte phototop', price: 20, unit: 'page' },
            { id: 'leather-phototop', name: 'Leather phototop', price: 25, unit: 'page' },
            { id: 'glitter-phototop', name: 'Glitter phototop', price: 25, unit: 'page' },
            { id: 'metal-pin', name: 'Metal pin', price: 5, unit: 'piece' },
            { id: 'sticker-names', name: 'Sticker names', price: 10, unit: 'piece' },
            { id: 'calendar-foil', name: 'Calendar foil', price: 25, unit: 'flat' },
            { id: 'folded-insert', name: 'Folded insert', price: 5, unit: 'flat' },
            { id: 'trifold-insert', name: 'Trifold insert', price: 10, unit: 'flat' }
        ];
        
        // List of flat add-ons that should be included in price per set (excluding Map layout)
        const flatAddonsInPricePerSet = [
            'vellum-jacket',
            'vellum-jacket-print',
            'different-sized-insert',
            'ribbon-addon',
            'calendar-foil',
            'folded-insert',
            'trifold-insert'
        ];
        
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('current-year').textContent = new Date().getFullYear();
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowFormatted = tomorrow.toISOString().split('T')[0];
            document.getElementById('event-date-input').value = tomorrowFormatted;
            eventDate = tomorrowFormatted;
            updateEventDateDisplay();
            
            setupOptionCards('event-type-options', 'eventType', true);
            setupOptionCards('size-options', 'size');
            setupOptionCards('envelope-options', 'envelope');
            setupOptionCards('paper-options', 'paper');
            setupOptionCards('seal-options', 'seal');
            
            // Initialize add-ons
            initializeAddons();
            
            document.getElementById('inserts-slider').addEventListener('input', function() {
                const insertCount = parseInt(this.value);
                const insertPrice = insertCount * INSERT_PRICE;
                document.getElementById('inserts-value').textContent = `${insertCount} insert${insertCount !== 1 ? 's' : ''}`;
                currentSelections.inserts = { value: insertCount, price: insertPrice };
                updateSummary();
            });
            
            document.getElementById('sets-input').addEventListener('input', function() {
                numberOfSets = parseInt(this.value) || 1;
                updateSummary();
            });
            
            document.getElementById('event-date-input').addEventListener('change', function() {
                eventDate = this.value;
                updateEventDateDisplay();
            });
            
            document.getElementById('layout-checkbox').addEventListener('change', function() {
                currentSelections.layout.required = this.checked;
                updateSummary();
            });
            
            document.getElementById('layout-type').addEventListener('change', function() {
                currentSelections.layout.type = this.value;
                updateSummary();
            });
            
            document.getElementById('rush-checkbox').addEventListener('change', function() {
                currentSelections.rush.required = this.checked;
                updateSummary();
            });
            
            document.getElementById('rush-type').addEventListener('change', function() {
                currentSelections.rush.type = this.value;
                updateSummary();
            });
            
            document.getElementById('reset-button').addEventListener('click', resetSelections);
            document.getElementById('print-button').addEventListener('click', printQuote);
            document.getElementById('copy-button').addEventListener('click', copyQuotation);
            
            updateSummary();
        });
        
        function initializeAddons() {
            const addonsGrid = document.getElementById('addons-grid');
            
            addonsData.forEach(addon => {
                const addonItem = document.createElement('div');
                addonItem.className = 'addon-item';
                addonItem.innerHTML = `
                    <div class="addon-header">
                        <input type="checkbox" class="addon-checkbox" id="addon-${addon.id}" data-id="${addon.id}" data-price="${addon.price}" data-unit="${addon.unit}">
                        <label class="addon-name" for="addon-${addon.id}">${addon.name}</label>
                    </div>
                    ${addon.unit !== 'flat' ? 
                        `<div class="addon-option">
                            <label>${addon.unit === 'page' ? 'Pages' : 'Pieces'}:</label>
                            <input type="number" class="addon-input" id="qty-${addon.id}" min="1" max="100" value="1" disabled>
                        </div>` 
                        : ''}
                `;
                addonsGrid.appendChild(addonItem);
                
                // Add event listeners for checkbox
                const checkbox = addonItem.querySelector('.addon-checkbox');
                const quantityInput = addonItem.querySelector('.addon-input');
                
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        if (quantityInput) quantityInput.disabled = false;
                        currentSelections.addons[addon.id] = {
                            name: addon.name,
                            price: addon.price,
                            unit: addon.unit,
                            quantity: quantityInput ? parseInt(quantityInput.value) || 1 : 1
                        };
                    } else {
                        if (quantityInput) {
                            quantityInput.disabled = true;
                            quantityInput.value = 1;
                        }
                        delete currentSelections.addons[addon.id];
                    }
                    updateSummary();
                });
                
                // Add event listener for quantity input
                if (quantityInput) {
                    quantityInput.addEventListener('input', function() {
                        if (checkbox.checked) {
                            currentSelections.addons[addon.id].quantity = parseInt(this.value) || 1;
                            updateSummary();
                        }
                    });
                }
            });
        }
        
        function setupOptionCards(containerId, selectionType, isEventType = false) {
            const container = document.getElementById(containerId);
            const optionCards = container.querySelectorAll('.option-card');
            optionCards.forEach(card => {
                card.addEventListener('click', function() {
                    optionCards.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    const value = this.getAttribute('data-value');
                    const price = parseInt(this.getAttribute('data-price'));
                    const name = this.querySelector('.option-name').textContent;
                    currentSelections[selectionType] = { value: value, price: price, name: name };
                    if (isEventType) updateEventTypeTitle();
                    updateSummary();
                });
            });
        }
        
        function updateEventTypeTitle() {
            const eventType = currentSelections.eventType.name;
            const title = eventType === "Special event" ? "Special event invitation" : `${eventType} invitation`;
            document.getElementById('event-type-title').textContent = title;
        }
        
        function updateEventDateDisplay() {
            if (eventDate) {
                const dateObj = new Date(eventDate);
                const formattedDate = dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                document.getElementById('event-date-display').textContent = `Event Date: ${formattedDate}`;
            } else {
                document.getElementById('event-date-display').textContent = `Event Date: Not specified`;
            }
        }
        
        function calculateAddonsTotal() {
            let total = 0;
            let summaryHTML = '';
            
            Object.keys(currentSelections.addons).forEach(addonId => {
                const addon = currentSelections.addons[addonId];
                let addonTotal = 0;
                
                if (addon.unit === 'flat') {
                    addonTotal = addon.price;
                    // Show all flat add-ons in the main summary (they will be moved to one-time fees if needed)
                    summaryHTML += `<div class="summary-line">${addon.name}</div>`;
                } else if (addon.unit === 'page' || addon.unit === 'piece') {
                    addonTotal = addon.price * addon.quantity * numberOfSets;
                    // Format: "X page(s)/item(s) Addon Name" with correct grammar
                    const unitText = addon.unit === 'page' ? (addon.quantity === 1 ? 'page' : 'pages') : 
                                    (addon.quantity === 1 ? 'item' : 'items');
                    summaryHTML += `<div class="summary-line">${addon.quantity} ${unitText} ${addon.name}</div>`;
                }
                
                total += addonTotal;
            });
            
            document.getElementById('addons-summary').innerHTML = summaryHTML;
            return total;
        }
        
        function updateSummary() {
            const sizePrice = currentSelections.size.price;
            const envelopePrice = currentSelections.envelope.price;
            const insertsPrice = currentSelections.inserts.price;
            const paperPrice = currentSelections.paper.price;
            const sealPrice = currentSelections.seal.price;
            
            // Calculate add-ons total
            calculateAddonsTotal();
            
            // Calculate layout fee based on number of inserts (pages)
            const numberOfPages = currentSelections.inserts.value + 1; // Base invitation + inserts
            
            // Calculate layout fee according to new rules
            let layoutFee = 0;
            let layoutSummary = "";
            
            if (currentSelections.layout.required) {
                // Box is checked
                if (currentSelections.layout.type === "own-layout") {
                    layoutSummary = "Own layout";
                } else if (currentSelections.layout.type === "no-layout") {
                    layoutFee = 200 + (100 * (numberOfPages - 1));
                    layoutSummary = `Layout fee: ₱${layoutFee}`;
                }
            } else {
                // Box is unchecked
                if (currentSelections.layout.type === "own-layout") {
                    layoutSummary = "Own layout";
                } else if (currentSelections.layout.type === "no-layout") {
                    if (numberOfSets >= 20) {
                        layoutSummary = "FREE layout";
                    } else {
                        layoutFee = 200 + (100 * (numberOfPages - 1));
                        layoutSummary = `Layout fee: ₱${layoutFee}`;
                    }
                }
            }
            
            // Calculate rush fee
            let rushFee = 0;
            let rushSummary = "";
            if (currentSelections.rush.required) {
                if (currentSelections.rush.type === "own-layout") {
                    rushFee = 10 * numberOfSets;
                    rushSummary = `Rush fee: ₱${rushFee}`;
                } else if (currentSelections.rush.type === "no-layout") {
                    rushFee = 100 + (10 * numberOfSets);
                    rushSummary = `Rush fee: ₱${rushFee}`;
                }
            }
            
            // Calculate price per set (including flat add-ons except Map layout)
            let addonPricePerSet = 0;
            Object.keys(currentSelections.addons).forEach(addonId => {
                const addon = currentSelections.addons[addonId];
                
                if (addonId === 'map-layout') {
                    // Map layout is NOT included in price per set (it's a one-time fee)
                    return;
                }
                
                if (addon.unit === 'flat') {
                    // Check if this flat add-on should be included in price per set
                    if (flatAddonsInPricePerSet.includes(addonId)) {
                        // These flat add-ons are included in price per set
                        addonPricePerSet += addon.price;
                    }
                    // Note: flat add-ons NOT in the list are treated as one-time fees
                } else {
                    // For per-page/per-piece add-ons, add their price to price per set
                    addonPricePerSet += addon.price * addon.quantity;
                }
            });
            
            const totalPerSet = BASE_PRICE + sizePrice + envelopePrice + insertsPrice + paperPrice + sealPrice + addonPricePerSet;
            
            // Calculate sets total (price for all sets)
            const setsTotal = totalPerSet * numberOfSets;
            
            // Calculate one-time fees (Map layout, layout fee, rush fee, and flat add-ons NOT in price per set)
            let oneTimeFeesTotal = 0;
            let oneTimeFeesHTML = "";
            
            Object.keys(currentSelections.addons).forEach(addonId => {
                const addon = currentSelections.addons[addonId];
                
                if (addonId === 'map-layout') {
                    // Map layout is always a one-time fee
                    oneTimeFeesTotal += addon.price;
                    oneTimeFeesHTML += `<div class="summary-line">Map layout: ₱${addon.price}</div>`;
                } else if (addon.unit === 'flat' && !flatAddonsInPricePerSet.includes(addonId)) {
                    // Flat add-ons NOT in the price-per-set list are one-time fees
                    oneTimeFeesTotal += addon.price;
                    oneTimeFeesHTML += `<div class="summary-line">${addon.name}: ₱${addon.price}</div>`;
                }
            });
            
            // Add layout fee to one-time fees if applicable
            if (layoutSummary && layoutSummary !== "FREE layout" && layoutSummary !== "Own layout") {
                oneTimeFeesTotal += layoutFee;
                oneTimeFeesHTML += `<div class="summary-line">${layoutSummary}</div>`;
            } else if (layoutSummary === "FREE layout" || layoutSummary === "Own layout") {
                // These don't have a fee, but we might want to show them in the summary
                // For now, we'll leave them out of the one-time fees section
            }
            
            // Add rush fee to one-time fees if applicable
            if (rushSummary) {
                oneTimeFeesTotal += rushFee;
                oneTimeFeesHTML += `<div class="summary-line">${rushSummary}</div>`;
            }
            
            const finalTotal = setsTotal + oneTimeFeesTotal;
            
            // Update display
            document.getElementById('price-per-set').textContent = `₱${totalPerSet} each`;
            document.getElementById('summary-size-line').textContent = `${currentSelections.size.name} size`;
            document.getElementById('summary-envelope-line').textContent = `${currentSelections.envelope.name} Envelope`;
            document.getElementById('summary-inserts-line').textContent = `${currentSelections.inserts.value} insert${currentSelections.inserts.value !== 1 ? 's' : ''}`;
            document.getElementById('summary-paper-line').textContent = `${currentSelections.paper.name} paper`;
            document.getElementById('summary-seal-line').textContent = currentSelections.seal.name;
            
            document.getElementById('sets-total').innerHTML = `${numberOfSets} sets x ₱${totalPerSet} each = ₱${setsTotal}`;
            
            // Update one-time fees section
            if (oneTimeFeesHTML) {
                document.getElementById('one-time-fees').innerHTML = oneTimeFeesHTML;
                document.getElementById('one-time-fees').style.display = 'block';
            } else {
                document.getElementById('one-time-fees').innerHTML = '';
                document.getElementById('one-time-fees').style.display = 'none';
            }
            
            document.getElementById('final-total').innerHTML = `Total: ₱${finalTotal}`;
        }
        
        function resetSelections() {
            const eventTypeCards = document.querySelectorAll('#event-type-options .option-card');
            eventTypeCards.forEach(card => card.classList.remove('selected'));
            eventTypeCards[0].classList.add('selected');
            currentSelections.eventType = { value: "wedding", price: 0, name: "Wedding" };
            updateEventTypeTitle();
            
            const sizeCards = document.querySelectorAll('#size-options .option-card');
            sizeCards.forEach(card => card.classList.remove('selected'));
            sizeCards[0].classList.add('selected');
            currentSelections.size = { value: "4r", price: 0, name: "4R" };
            
            const envelopeCards = document.querySelectorAll('#envelope-options .option-card');
            envelopeCards.forEach(card => card.classList.remove('selected'));
            envelopeCards[1].classList.add('selected');
            currentSelections.envelope = { value: "plain-white", price: 0, name: "Plain white" };
            
            document.getElementById('inserts-slider').value = 0;
            document.getElementById('inserts-value').textContent = '0 inserts';
            currentSelections.inserts = { value: 0, price: 0 };
            
            const paperCards = document.querySelectorAll('#paper-options .option-card');
            paperCards.forEach(card => card.classList.remove('selected'));
            paperCards[0].classList.add('selected');
            currentSelections.paper = { value: "matte", price: 0, name: "Matte" };
            
            const sealCards = document.querySelectorAll('#seal-options .option-card');
            sealCards.forEach(card => card.classList.remove('selected'));
            sealCards[0].classList.add('selected');
            currentSelections.seal = { value: "no-seal", price: 0, name: "No seal" };
            
            // Reset add-ons
            document.querySelectorAll('.addon-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.querySelectorAll('.addon-input').forEach(input => {
                input.value = 1;
                input.disabled = true;
            });
            currentSelections.addons = {};
            
            document.getElementById('layout-checkbox').checked = false;
            document.getElementById('layout-type').value = "no-layout";
            document.getElementById('rush-checkbox').checked = false;
            document.getElementById('rush-type').value = "no-layout";
            currentSelections.layout = { required: false, type: "no-layout", pages: 1 };
            currentSelections.rush = { required: false, type: "no-layout" };
            
            document.getElementById('sets-input').value = 20;
            numberOfSets = 20;
            
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowFormatted = tomorrow.toISOString().split('T')[0];
            document.getElementById('event-date-input').value = tomorrowFormatted;
            eventDate = tomorrowFormatted;
            updateEventDateDisplay();
            
            updateSummary();
            alert("All selections have been reset to default values.");
        }
        
        function copyQuotation() {
            const sizePrice = currentSelections.size.price;
            const envelopePrice = currentSelections.envelope.price;
            const insertsPrice = currentSelections.inserts.price;
            const paperPrice = currentSelections.paper.price;
            const sealPrice = currentSelections.seal.price;
            
            // Calculate add-ons total and summary
            let addonsSummary = "";
            
            Object.keys(currentSelections.addons).forEach(addonId => {
                const addon = currentSelections.addons[addonId];
                
                if (addon.unit === 'flat') {
                    // Show all flat add-ons in the main summary
                    addonsSummary += `${addon.name}\n`;
                } else if (addon.unit === 'page' || addon.unit === 'piece') {
                    // Format: "X page(s)/item(s) Addon Name" with correct grammar
                    const unitText = addon.unit === 'page' ? (addon.quantity === 1 ? 'page' : 'pages') : 
                                    (addon.quantity === 1 ? 'item' : 'items');
                    addonsSummary += `${addon.quantity} ${unitText} ${addon.name}\n`;
                }
            });
            
            // Calculate layout fee based on number of inserts (pages)
            const numberOfPages = currentSelections.inserts.value + 1; // Base invitation + inserts
            
            let layoutFee = 0;
            let layoutSummary = "";
            
            if (currentSelections.layout.required) {
                // Box is checked
                if (currentSelections.layout.type === "own-layout") {
                    layoutSummary = "Own layout";
                } else if (currentSelections.layout.type === "no-layout") {
                    layoutFee = 200 + (100 * (numberOfPages - 1));
                    layoutSummary = `Layout fee: ₱${layoutFee}`;
                }
            } else {
                // Box is unchecked
                if (currentSelections.layout.type === "own-layout") {
                    layoutSummary = "Own layout";
                } else if (currentSelections.layout.type === "no-layout") {
                    if (numberOfSets >= 20) {
                        layoutSummary = "FREE layout";
                    } else {
                        layoutFee = 200 + (100 * (numberOfPages - 1));
                        layoutSummary = `Layout fee: ₱${layoutFee}`;
                    }
                }
            }
            
            let rushFee = 0;
            let rushSummary = "";
            if (currentSelections.rush.required) {
                if (currentSelections.rush.type === "own-layout") {
                    rushFee = 10 * numberOfSets;
                    rushSummary = `Rush fee: ₱${rushFee}`;
                } else if (currentSelections.rush.type === "no-layout") {
                    rushFee = 100 + (10 * numberOfSets);
                    rushSummary = `Rush fee: ₱${rushFee}`;
                }
            }
            
            // Calculate price per set (including flat add-ons except Map layout)
            let addonPricePerSet = 0;
            Object.keys(currentSelections.addons).forEach(addonId => {
                const addon = currentSelections.addons[addonId];
                
                if (addonId === 'map-layout') {
                    // Map layout is NOT included in price per set (it's a one-time fee)
                    return;
                }
                
                if (addon.unit === 'flat') {
                    // Check if this flat add-on should be included in price per set
                    if (flatAddonsInPricePerSet.includes(addonId)) {
                        // These flat add-ons are included in price per set
                        addonPricePerSet += addon.price;
                    }
                } else {
                    // For per-page/per-piece add-ons, add their price to price per set
                    addonPricePerSet += addon.price * addon.quantity;
                }
            });
            
            const totalPerSet = BASE_PRICE + sizePrice + envelopePrice + insertsPrice + paperPrice + sealPrice + addonPricePerSet;
            
            // Calculate sets total (price for all sets)
            const setsTotal = totalPerSet * numberOfSets;
            
            // Calculate one-time fees (Map layout, layout fee, rush fee, and flat add-ons NOT in price per set)
            let oneTimeFeesTotal = 0;
            let oneTimeFeesText = "";
            
            Object.keys(currentSelections.addons).forEach(addonId => {
                const addon = currentSelections.addons[addonId];
                
                if (addonId === 'map-layout') {
                    // Map layout is always a one-time fee
                    oneTimeFeesTotal += addon.price;
                    oneTimeFeesText += `Map layout: ₱${addon.price}\n`;
                } else if (addon.unit === 'flat' && !flatAddonsInPricePerSet.includes(addonId)) {
                    // Flat add-ons NOT in the price-per-set list are one-time fees
                    oneTimeFeesTotal += addon.price;
                    oneTimeFeesText += `${addon.name}: ₱${addon.price}\n`;
                }
            });
            
            // Add layout fee to one-time fees if applicable
            if (layoutSummary && layoutSummary !== "FREE layout" && layoutSummary !== "Own layout") {
                oneTimeFeesTotal += layoutFee;
                oneTimeFeesText += `${layoutSummary}\n`;
            }
            
            // Add rush fee to one-time fees if applicable
            if (rushSummary) {
                oneTimeFeesTotal += rushFee;
                oneTimeFeesText += `${rushSummary}\n`;
            }
            
            const finalTotal = setsTotal + oneTimeFeesTotal;
            
            const eventType = currentSelections.eventType.name;
            const eventTitle = eventType === "Special event" ? "Special event invitation" : `${eventType} invitation`;
            
            let formattedEventDate = "Not specified";
            if (eventDate) {
                const dateObj = new Date(eventDate);
                formattedEventDate = dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            }
            
            let quotationText = `${eventTitle}
Event Date: ${formattedEventDate}

₱${totalPerSet} each

${currentSelections.size.name} size
${currentSelections.envelope.name} Envelope
${currentSelections.inserts.value} insert${currentSelections.inserts.value !== 1 ? 's' : ''}
${currentSelections.paper.name} paper
${currentSelections.seal.name}`;

            if (addonsSummary) quotationText += `\n${addonsSummary}`;
            
            quotationText += `\n${numberOfSets} sets x ₱${totalPerSet} each = ₱${setsTotal}`;
            
            if (oneTimeFeesText) quotationText += `\n\n${oneTimeFeesText}`;
            
            quotationText += `\nTotal: ₱${finalTotal}`;
            
            navigator.clipboard.writeText(quotationText).then(() => {
                const notification = document.getElementById('notification');
                notification.classList.add('show');
                setTimeout(() => notification.classList.remove('show'), 3000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy quotation to clipboard. Please try again.');
            });
        }
        
        function printQuote() {
            window.print();
        }
    </script>
</body>
</html>
