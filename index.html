<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invitation Price Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #ffffff; color: #333333; line-height: 1.5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 10px 20px; background-color: #f5f5f5; border-bottom: 1px solid #e0e0e0; margin-bottom: 20px; }
        h1 { font-size: 1.5rem; color: #333333; font-weight: 400; }
        .calculator-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        @media (max-width: 900px) { .calculator-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
    align-items: start;
} }
        .options-panel, .result-panel {
			background-color: white;
			border: 1px solid #e0e0e0;
			padding: 20px;
			position: sticky;
			top: 20px;
			height: fit-content;
			max-height: calc(100vh - 40px);
			overflow-y: auto;
			align-self: start;}
        .result-panel {
    display: flex;
    flex-direction: column;
    position: sticky;
    top: 20px;
    height: fit-content;
    max-height: calc(100vh - 40px);
    overflow-y: auto;
    align-self: start;
}

@media (max-width: 900px) {
    .result-panel {
        position: static;
        max-height: none;
    }
}
        .section-title { font-size: 1.1rem; color: #333333; margin-bottom: 15px; padding-bottom: 6px; border-bottom: 1px solid #e0e0e0; font-weight: 500; }
        .option-group { margin-bottom: 20px; }
        .option-label { display: block; font-weight: 500; margin-bottom: 8px; color: #333333; font-size: 0.95rem; }
        .option-grid, .event-option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .event-option-grid { grid-template-columns: repeat(5, 1fr); }
        @media (max-width: 768px) { .event-option-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 480px) { .event-option-grid { grid-template-columns: 1fr 1fr; } }
        .option-card { border: 1px solid #cccccc; border-radius: 4px; padding: 10px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; text-align: center; background-color: #ffffff; }
        .option-card:hover { border-color: #666666; background-color: #f9f9f9; }
        .option-card.selected { border-color: #333333; background-color: #f0f0f0; font-weight: 500; }
        .option-name { color: #333333; font-size: 0.85rem; }
        .slider-container { padding: 0 10px; }
        .slider-value { text-align: center; font-weight: 500; margin-top: 6px; color: #333333; font-size: 0.95rem; }
        input[type="range"] { width: 100%; height: 6px; border-radius: 3px; background: #e0e0e0; outline: none; -webkit-appearance: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: #333333; cursor: pointer; border: 1px solid #cccccc; }
        .input-group { margin-bottom: 15px; }
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .input-label { display: block; font-weight: 500; margin-bottom: 6px; color: #333333; font-size: 0.95rem; }
        .text-input, .date-input, .select-input { width: 100%; padding: 8px; border: 1px solid #cccccc; border-radius: 4px; font-size: 0.95rem; background-color: #ffffff; }
        .text-input:focus, .date-input:focus, .select-input:focus { outline: none; border-color: #666666; }
        .layout-rush-section { margin: 15px 0; }
        .layout-rush-row { display: grid; grid-template-columns: auto 1fr; gap: 10px; align-items: center; margin-bottom: 10px; padding: 10px; background-color: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 4px; }
        .layout-rush-checkbox { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; }
        .layout-rush-checkbox input { margin: 0; }
        .discount-checkbox-row { margin-top: 10px; padding: 10px; background-color: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 4px; }
        .discount-checkbox { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; }
        .discount-checkbox input { margin: 0; }
        .addon-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .addon-item { display: flex; flex-direction: column; padding: 10px; border: 1px solid #e0e0e0; border-radius: 4px; background-color: #f9f9f9; height: 100%; }
        .addon-header { display: flex; align-items: flex-start; margin-bottom: 8px; }
        .addon-checkbox { margin-right: 10px; margin-top: 2px; }
        .addon-name { font-weight: 500; color: #333333; font-size: 0.9rem; }
        .addon-option { display: flex; align-items: center; margin-top: 5px; font-size: 0.85rem; color: #666666; }
        .addon-input { width: 70px; padding: 4px 6px; border: 1px solid #cccccc; border-radius: 3px; margin-left: 8px; font-size: 0.85rem; text-align: center; }
        .addon-input:disabled { background-color: #f0f0f0; color: #999999; cursor: not-allowed; }
        .button-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 15px; }
        .action-button { background-color: #f0f0f0; color: #333333; border: 1px solid #cccccc; padding: 8px; font-size: 0.85rem; border-radius: 4px; cursor: pointer; transition: background-color 0.2s; font-weight: 500; height: 40px; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .action-button:hover { background-color: #e5e5e5; border-color: #999999; }
        .copy-button { background-color: #333333; color: white; border: 1px solid #333333; width: 100%; margin-top: 15px; padding: 10px; height: 44px; font-size: 0.9rem; }
        .copy-button:hover { background-color: #444444; }
        .copy-price-button { background-color: #666666; color: white; border: 1px solid #666666; width: 100%; margin-top: 10px; padding: 10px; height: 44px; font-size: 0.9rem; }
        .copy-price-button:hover { background-color: #777777; }
        .summary-container { flex-grow: 1; }
        .event-type-title { font-size: 1.2rem; font-weight: 500; color: #333333; margin-bottom: 5px; text-align: center; }
        .event-date-line { color: #666666; font-size: 0.9rem; text-align: center; margin-bottom: 3px; }
        .payment-method-line { color: #666666; font-size: 0.9rem; text-align: center; margin-bottom: 15px; }
        .price-per-set { font-size: 2.2rem; font-weight: 300; color: #333333; margin-bottom: 15px; text-align: center; line-height: 1; }
        .summary-details { margin-bottom: 15px; padding: 12px; background-color: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 4px; }
        .summary-line { margin-bottom: 4px; font-size: 0.9rem; line-height: 1.3; }
        .addons-summary { margin-top: 8px; }
        .sets-total { margin-top: 15px; padding-top: 10px; border-top: 1px solid #cccccc; font-weight: 600; font-size: 1rem; text-align: center; color: #333333; }
        .one-time-fees { margin-top: 8px; padding-top: 8px; border-top: 1px dashed #cccccc; }
        .final-total { margin-top: 15px; padding-top: 12px; border-top: 2px solid #333333; font-weight: 600; font-size: 1.2rem; text-align: center; color: #333333; }
        .payment-methods-section { margin-top: 15px; padding-top: 12px; border-top: 1px solid #cccccc; }
        .payment-method-option { margin-bottom: 8px; padding: 8px; border: 1px solid #e0e0e0; border-radius: 4px; background-color: #f9f9f9; }
        .payment-method-title { font-weight: 600; margin-bottom: 3px; color: #333333; font-size: 0.9rem; }
        .payment-method-details { font-size: 0.85rem; line-height: 1.3; }
        footer { text-align: center; margin-top: 25px; padding-top: 12px; border-top: 1px solid #e0e0e0; color: #666666; font-size: 0.8rem; }
        .notification { position: fixed; top: 20px; right: 20px; background-color: #333333; color: white; padding: 10px 16px; border-radius: 4px; font-size: 0.85rem; opacity: 0; transform: translateY(-10px); transition: opacity 0.3s, transform 0.3s; z-index: 1000; }
        .notification.show { opacity: 1; transform: translateY(0); }
        .section-divider { height: 1px; background-color: #e0e0e0; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <header><h1>Invitation Price Calculator</h1></header>
        <div class="calculator-wrapper">
            <div class="options-panel">
                <h2 class="section-title">Customization Options</h2>
                <div class="option-group">
                    <label class="option-label">1. Event Type</label>
                    <div class="event-option-grid" id="event-type-options">
                        <div class="option-card selected" data-value="wedding" data-price="0"><div class="option-name">Wedding</div></div>
                        <div class="option-card" data-value="debut" data-price="0"><div class="option-name">Debut</div></div>
                        <div class="option-card" data-value="birthday" data-price="0"><div class="option-name">Birthday</div></div>
                        <div class="option-card" data-value="baptism" data-price="0"><div class="option-name">Baptism</div></div>
                        <div class="option-card" data-value="special-event" data-price="0"><div class="option-name">Special event</div></div>
                    </div>
                </div>
                <div class="option-group"><label class="option-label">2. Size</label>
                    <div class="option-grid" id="size-options">
                        <div class="option-card selected" data-value="4r" data-price="0"><div class="option-name">4R</div></div>
                        <div class="option-card" data-value="5r" data-price="10"><div class="option-name">5R</div></div>
                    </div>
                </div>
                <div class="option-group"><label class="option-label">3. Envelope Type</label>
                    <div class="option-grid" id="envelope-options">
                        <div class="option-card" data-value="no-envelope" data-price="-5"><div class="option-name">No envelope</div></div>
                        <div class="option-card selected" data-value="plain-white" data-price="0"><div class="option-name">Plain white</div></div>
                        <div class="option-card" data-value="colored" data-price="15"><div class="option-name">Colored</div></div>
                        <div class="option-card" data-value="transparent" data-price="15"><div class="option-name">Transparent</div></div>
                        <div class="option-card" data-value="premium-colored" data-price="20"><div class="option-name">Premium colored</div></div>
                        <div class="option-card" data-value="vellum-cover" data-price="20"><div class="option-name">Vellum cover</div></div>
                        <div class="option-card" data-value="gatefold" data-price="40"><div class="option-name">Gatefold</div></div>
                        <div class="option-card" data-value="pocket-cover" data-price="25"><div class="option-name">Pocket Cover</div></div>
                        <div class="option-card" data-value="pouch-cover" data-price="55"><div class="option-name">Pouch Cover</div></div>
                        <div class="option-card" data-value="trifold" data-price="45"><div class="option-name">Trifold</div></div>
                        <div class="option-card" data-value="vellum-cover-print" data-price="30"><div class="option-name">Vellum cover with print</div></div>
                        <div class="option-card" data-value="portrait-colored" data-price="35"><div class="option-name">Portrait colored</div></div>
                        <div class="option-card" data-value="premium-portrait-colored" data-price="45"><div class="option-name">Premium portrait colored</div></div>
                    </div>
                </div>
  
				<input type="checkbox" id="envelope-checkbox" style="vertical-align: middle;">
				<label for="envelope-checkbox" ></label style="vertical-align: middle; margin-right: 10px;">
				<select class="select-input" id="color-select" style="vertical-align: middle; height: 40px; width: 160px; font-size: 15px; margin-right: 10px;">
					<option value="">Select color</option>
					<option value="Amethyst">Amethyst</option>
					<option value="Asea 44">Asea 44</option>
					<option value="Apple green">Apple green</option>
					<option value="Argilla">Argilla</option>
					<option value="Azure">Azure</option>
					<option value="Baltic sea">Baltic sea</option>
					<option value="Beige">Beige</option>
					<option value="Biscuit">Biscuit</option>
					<option value="Black">Black</option>
					<option value="Black nero">Black nero</option>
					<option value="Blush">Blush</option>
					<option value="Blush pink">Blush pink</option>
					<option value="Bordeaux">Bordeaux</option>
					<option value="Bronze">Bronze</option>
					<option value="Brown">Brown</option>
					<option value="Burgundy">Burgundy</option>
					<option value="Burnt orange">Burnt orange</option>
					<option value="Carmine">Carmine</option>
					<option value="Champagne">Champagne</option>
					<option value="Cherry red">Cherry red</option>
					<option value="Coffee brown">Coffee brown</option>
					<option value="Copper">Copper</option>
					<option value="Cream">Cream</option>
					<option value="Dark brown">Dark brown</option>
					<option value="Dark gold">Dark gold</option>
					<option value="Dark gray">Dark gray</option>
					<option value="Dark green">Dark green</option>
					<option value="Dark red">Dark red</option>
					<option value="Dusty blue">Dusty blue</option>
					<option value="Emerald green">Emerald green</option>
					<option value="Flamingo">Flamingo</option>
					<option value="Forest green">Forest green</option>
					<option value="Gold">Gold</option>
					<option value="Ivory">Ivory</option>
					<option value="Kraft">Kraft</option>
					<option value="Kraft gold">Kraft gold</option>
					<option value="Light blue">Light blue</option>
					<option value="Light dusty-blue">Light dusty blue</option>
					<option value="Light pink">Light pink</option>
					<option value="Light taupe">Light taupe</option>
					<option value="Lime green">Lime green</option>
					<option value="Maroon">Maroon</option>
					<option value="Midnight blue">Midnight blue</option>
					<option value="Misty rose">Misty rose</option>
					<option value="Mustard">Mustard</option>
					<option value="Navy blue">Navy blue</option>
					<option value="Old rose">Old rose</option>
					<option value="Olive green">Olive green</option>
					<option value="Peacock gold">Peacock gold</option>
					<option value="Pink">Pink</option>
					<option value="Plum">Plum</option>
					<option value="Purple">Purple</option>
					<option value="Red">Red</option>
					<option value="Red fever">Red fever</option>
					<option value="Rosebud">Rosebud</option>
					<option value="Rosegold">Rosegold</option>
					<option value="Rosequartz">Rosequartz</option>
					<option value="Rosso">Rosso</option>
					<option value="Royal blue">Royal blue</option>
					<option value="Rust">Rust</option>
					<option value="Sage green">Sage green</option>
					<option value="Silver">Silver</option>
					<option value="Sirio gold">Sirio gold</option>
					<option value="Stardream azalea fuchsia">Stardream Azalea (Fuchsia)</option>
					<option value="Stone gray">Stone gray</option>
					<option value="Tan">Tan</option>
					<option value="Teal green">Teal green</option>
					<option value="Verde">Verde</option>
					<option value="Vista">Vista</option>
					<option value="White">White</option>
					<option value="Yellow gold">Yellow gold</option>

				</select>
				<select class="select-input" id="texture-select" style="vertical-align: middle; height: 40px; width: 160px; font-size: 15px; margin-right: 10px;">
					<option value="">Select texture</option>
					<option value="Matte">Matte</option>
					<option value="Glossy">Glossy</option>
					<option value="Textured">Textured</option>
				</select>

			
                <div class="option-group"><label class="option-label">4. Number of Inserts</label>
                    <div class="slider-container"><input type="range" id="inserts-slider" min="0" max="10" value="0" step="1"><div class="slider-value" id="inserts-value">0 inserts</div></div>
                </div>
                <div class="option-group"><label class="option-label">5. Paper Type</label>
                    <div class="option-grid" id="paper-options">
                        <div class="option-card selected" data-value="matte" data-price="0"><div class="option-name">Matte</div></div>
                        <div class="option-card" data-value="glossy" data-price="0"><div class="option-name">Glossy</div></div>
                        <div class="option-card" data-value="premium-matte" data-price="5"><div class="option-name">Premium matte</div></div>
                        <div class="option-card" data-value="matte-textured" data-price="5"><div class="option-name">Matte textured</div></div>
                        <div class="option-card" data-value="glossy-textured" data-price="5"><div class="option-name">Glossy textured</div></div>
                    </div>
                </div>
                <div class="option-group"><label class="option-label">6. Envelope Seal</label>
                    <div class="option-grid" id="seal-options">
                        <div class="option-card selected" data-value="no-seal" data-price="0"><div class="option-name">No seal</div></div>
                        <div class="option-card" data-value="sticker-seal" data-price="0"><div class="option-name">Sticker seal</div></div>
                        <div class="option-card" data-value="wax-seal" data-price="5"><div class="option-name">Wax seal</div></div>
                        <div class="option-card" data-value="belt" data-price="5"><div class="option-name">Belt</div></div>
                        <div class="option-card" data-value="wax-seal-string" data-price="10"><div class="option-name">Wax seal with string</div></div>
                        <div class="option-card" data-value="belt-print" data-price="10"><div class="option-name">Belt with print</div></div>
                        <div class="option-card" data-value="frosted-belt" data-price="10"><div class="option-name">Frosted belt</div></div>
                        <div class="option-card" data-value="ribbon" data-price="10"><div class="option-name">Ribbon</div></div>
                        <div class="option-card" data-value="printed-tag" data-price="0"><div class="option-name">Printed tag</div></div>
                        <div class="option-card" data-value="jute-string" data-price="5"><div class="option-name">Jute string</div></div>
                        <div class="option-card" data-value="wax-seal-flower" data-price="15"><div class="option-name">Wax seal with flower</div></div>
                        <div class="option-card" data-value="frosted-belt-print" data-price="15"><div class="option-name">Frosted belt with print</div></div>
                        <div class="option-card" data-value="frayed-ribbon" data-price="15"><div class="option-name">Frayed ribbon</div></div>
                        <div class="option-card" data-value="wax-seal-string-flower" data-price="20"><div class="option-name">Wax seal with string and flower</div></div>
                    </div>
                </div>
                
                <!-- Add-ons Section -->
                <div class="option-group">
                    <label class="option-label">7. Add-ons</label>
                    <div class="addon-grid" id="addons-grid">
                        <!-- Add-ons will be added here by JavaScript -->
                    </div>
                </div>
                
                <div class="section-divider"></div>
				<div class="option-group">
					<label class="option-label">Import Quotation</label>
					<div style="margin-bottom: 8px; font-size: 0.85rem; color: #666;">
					</div>
					<textarea class="text-input" id="import-textarea" rows="4" placeholder="Paste quotation text here..."></textarea>
					<button class="action-button" id="import-button" style="margin-top: 10px; width: 100%;">
						<i class="fas fa-file-import"></i> Import Quotation
					</button>
				</div>
				<div class="section-divider"></div>
				<h2 class="section-title">Customization Options</h2>
                
                <!-- Layout & Rush Section -->
                <h2 class="section-title">Order Details</h2>
                <div class="layout-rush-section">
                    <label class="option-label">Layout Selection</label>
                    <div class="layout-rush-row">
                        <div class="layout-rush-checkbox"><input type="checkbox" id="layout-checkbox"><label for="layout-checkbox">Layout Required</label></div>
                        <select class="select-input" id="layout-type">
                            <option value="no-layout">No layout</option>
                            <option value="own-layout">Own layout</option>
                        </select>
                    </div>
                    <label class="option-label">Rush Fee</label>
                    <div class="layout-rush-row">
                        <div class="layout-rush-checkbox"><input type="checkbox" id="rush-checkbox"><label for="rush-checkbox">Rush Order</label></div>
                        <select class="select-input" id="rush-type">
                            <option value="no-layout">No layout</option>
                            <option value="own-layout">Own layout</option>
                        </select>
                    </div>
                    <div class="discount-checkbox-row">
                        <div class="discount-checkbox"><input type="checkbox" id="discount-checkbox"><label for="discount-checkbox">Discount (Remove free sets, pay less but receive same quantity)</label></div>
                    </div>
                </div>
                
                <!-- Payment Method Section -->
                <div class="option-group">
                    <label class="option-label">Payment Method</label>
                    <div class="option-grid" id="payment-method-options">
                        <div class="option-card" data-value="none"><div class="option-name">Show All</div></div>
                        <div class="option-card selected" data-value="direct-shipping"><div class="option-name">Direct shipping</div></div>
                        <div class="option-card" data-value="shopee-checkout"><div class="option-name">Shopee checkout</div></div>
                        <div class="option-card" data-value="shopee-checkout-full"><div class="option-name">Shopee checkout full payment</div></div>
                    </div>
                </div>
                
                <!-- Location Section -->
                <div class="option-group">
                    <label class="option-label">Location</label>
                    <select class="select-input" id="location-select">
                        <option value="">Select location</option>
                        <option value="ncr">NCR</option>
                        <option value="north-luzon">North Luzon</option>
                        <option value="central-luzon">Central Luzon</option>
                        <option value="south-luzon">South Luzon</option>
                        <option value="visayas">Visayas</option>
                        <option value="mindanao">Mindanao</option>
                    </select>
                </div>
                
                <div class="input-row">
                    <div class="input-group"><label class="input-label">Number of Sets</label><input type="number" class="text-input" id="sets-input" min="1" max="1000" value="20"></div>
                    <div class="input-group"><label class="input-label">Event Date</label><input type="date" class="date-input" id="event-date-input" value=""></div>
                </div>
                <div class="button-row">
                    <button class="action-button reset-button" id="reset-button"><i class="fas fa-redo-alt"></i> Reset All</button>
                    <button class="action-button" id="print-button"><i class="fas fa-print"></i> Print</button>
                </div>
            </div>
            <div class="result-panel">
                <div class="summary-container">
                    <h2 class="section-title">Quotation Summary</h2>
                    <div class="event-type-title" id="event-type-title">Wedding invitation</div>
                    <div class="event-date-line" id="event-date-display"></div>
                    <div class="payment-method-line" id="payment-method-display"></div>
                    <div class="price-per-set" id="price-per-set">₱25 each</div>
                    <div class="summary-details">
                        <div class="summary-line" id="summary-size-line">4R size</div>
                        <div class="summary-line" id="summary-envelope-line">Plain white Envelope</div>
                        <div class="summary-line" id="summary-inserts-line">0 inserts</div>
                        <div class="summary-line" id="summary-paper-line">Matte paper</div>
                        <div class="summary-line" id="summary-seal-line">No seal</div>
                        <div class="addons-summary" id="addons-summary"></div>
                        <div class="one-time-fees" id="one-time-fees"></div>
                        <div class="sets-total" id="sets-total">20 sets x ₱25 each = ₱500</div>
                    </div>
                    <div class="final-total" id="final-total">Total: ₱500</div>
                    <div class="payment-methods-section" id="payment-methods-section"></div>
                    <button class="copy-button" id="copy-button"><i class="fas fa-copy"></i> Copy Quotation Summary</button>
                    <button class="copy-price-button" id="copy-price-button"><i class="fas fa-copy"></i> Copy Price Summary</button>
                </div>
            </div>
        </div>
        <footer>
            <p>Invitation Price Calculator &copy; <span id="current-year">2023</span> | All prices are per invitation set in Philippine Peso</p>
            <p>Note: Additional charges may apply for rush orders, special printing techniques, or custom artwork.</p>
        </footer>
    </div>
    <div class="notification" id="notification">Quotation copied to clipboard!</div>
    <div class="notification" id="price-notification" style="top: 70px;">Price summary copied to clipboard!</div>
    <script>
        const BASE_PRICE = 25;
        const INSERT_PRICE = 5;
        let currentSelections = {
            eventType: { value: "wedding", price: 0, name: "Wedding" },
            size: { value: "4r", price: 0, name: "4R" },
            envelope: { value: "plain-white", price: 0, name: "Plain white", custom: false, color: "", texture: "" },
            inserts: { value: 0, price: 0 },
            paper: { value: "matte", price: 0, name: "Matte" },
            seal: { value: "no-seal", price: 0, name: "No seal" },
            layout: { required: false, type: "no-layout", pages: 1 },
            rush: { required: false, type: "no-layout" },
            paymentMethod: "none", // none, direct-shipping, shopee-checkout, shopee-checkout-full
            location: "",
            addons: {},
            discount: false
        };
        let numberOfSets = 20;
        let eventDate = "";
        
        // Add-ons data with pricing information
        const addonsData = [
            { id: 'map-layout', name: 'Map layout', price: 200, unit: 'flat' },
            { id: 'transparent-insert', name: 'Transparent insert', price: 30, unit: 'page' },
            { id: 'acrylic-insert', name: 'Acrylic insert', price: 80, unit: 'page' },
            { id: 'deckled-edge-cut', name: 'Deckled edge cut', price: 5, unit: 'page' },
            { id: 'custom-cut', name: 'Custom cut', price: 10, unit: 'page' },
            { id: 'photo-print', name: 'Photo print', price: 5, unit: 'page' },
            { id: 'solid-color-print', name: 'Solid color print', price: 5, unit: 'page' },
            { id: 'vellum-jacket', name: 'Vellum jacket', price: 25, unit: 'flat' },
            { id: 'vellum-jacket-print', name: 'Vellum jacket with print', price: 35, unit: 'flat' },
            { id: 'frosted-insert', name: 'Frosted insert', price: 15, unit: 'page' },
            { id: 'different-sized-insert', name: 'Different sized insert', price: 5, unit: 'flat' },
            { id: 'back-to-back-print', name: 'Back to back print', price: 5, unit: 'page' },
            { id: 'ribbon-addon', name: 'Ribbon', price: 10, unit: 'flat' },
            { id: 'sticker-seal-addon', name: 'Sticker seal', price: 3, unit: 'flat' },
            { id: 'eyelet', name: 'Eyelet', price: 10, unit: 'piece' },
            { id: 'glossy-phototop', name: 'Glossy phototop', price: 20, unit: 'page' },
            { id: 'matte-phototop', name: 'Matte phototop', price: 20, unit: 'page' },
            { id: 'leather-phototop', name: 'Leather phototop', price: 25, unit: 'page' },
            { id: 'glitter-phototop', name: 'Glitter phototop', price: 25, unit: 'page' },
            { id: 'metal-pin', name: 'Metal pin', price: 5, unit: 'piece' },
            { id: 'sticker-names', name: 'Sticker names', price: 10, unit: 'piece' },
            { id: 'calendar-foil', name: 'Calendar foil', price: 25, unit: 'flat' },
            { id: 'folded-insert', name: 'Folded insert', price: 5, unit: 'flat' },
            { id: 'trifold-insert', name: 'Trifold insert', price: 10, unit: 'flat' },
            { id: 'liner', name: 'Liner', price: 20, unit: 'flat' },
            { id: 'arc-cut', name: 'Arc cut', price: 5, unit: 'page' },
			{ id: 'decals', name: 'Decals', price: 15, unit: 'piece' },
            { id: 'gold-foil', name: 'Gold foil', price: 15, unit: 'page' },
            { id: 'silver-foil', name: 'Silver foil', price: 15, unit: 'page' },			
            { id: 'rosegold-foil', name: 'Rosegold foil', price: 15, unit: 'page' },			
            { id: 'gold-foil-full-page', name: 'Gold foil full page', price: 20, unit: 'page' },
            { id: 'silver-foil-full-page', name: 'Silver foil full page', price: 20, unit: 'page' },			
            { id: 'rosegold-foil-full-page', name: 'Rosegold foil full page', price: 20, unit: 'page' },			
            { id: 'envelope-print', name: 'Envelope print', price: 10, unit: 'flat' }
        ];
        
        // List of flat add-ons that should be included in price per set (excluding Map layout)
        const flatAddonsInPricePerSet = [
            'vellum-jacket',
            'vellum-jacket-print',
            'different-sized-insert',
            'ribbon-addon',
            'calendar-foil',
            'folded-insert',
            'trifold-insert',
			'sticker-seal',
            'liner' // Added Liner to price per set
        ];
        
        // Location display names
        const locationNames = {
            'ncr': 'NCR',
            'north-luzon': 'North Luzon',
            'central-luzon': 'Central Luzon',
            'south-luzon': 'South Luzon',
            'visayas': 'Visayas',
            'mindanao': 'Mindanao'
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // Try to load saved data from localStorage
            loadSavedData();
            
            setupOptionCards('event-type-options', 'eventType', true);
            setupOptionCards('size-options', 'size');
            setupOptionCards('envelope-options', 'envelope');
            setupOptionCards('paper-options', 'paper');
            setupOptionCards('seal-options', 'seal');
            setupOptionCards('payment-method-options', 'paymentMethod', false, true);
            
            // Initialize add-ons
            initializeAddons();
            
           document.getElementById('envelope-checkbox').addEventListener('change', function() {
                currentSelections.envelope.custom = this.checked;
                updateSummary();
                saveToLocalStorage();
            });
			
			document.getElementById('color-select').addEventListener('change', function() {
                currentSelections.envelope.color = this.value;
                updateSummary();
                saveToLocalStorage();
            });
			
			document.getElementById('texture-select').addEventListener('change', function() {
                currentSelections.envelope.texture = this.value;
                updateSummary();
                saveToLocalStorage();
            });
			
			document.getElementById('inserts-slider').addEventListener('input', function() {
                const insertCount = parseInt(this.value);
                const insertPrice = insertCount * INSERT_PRICE;
                document.getElementById('inserts-value').textContent = `${insertCount} insert${insertCount !== 1 ? 's' : ''}`;
                currentSelections.inserts = { value: insertCount, price: insertPrice };
                updateSummary();
                saveToLocalStorage();
            });
            
            document.getElementById('sets-input').addEventListener('input', function() {
                numberOfSets = parseInt(this.value) || 1;
                updateSummary();
                saveToLocalStorage();
            });
            
            document.getElementById('event-date-input').addEventListener('change', function() {
                eventDate = this.value;
                updateEventDateDisplay();
                saveToLocalStorage();
            });
            
            document.getElementById('layout-checkbox').addEventListener('change', function() {
                currentSelections.layout.required = this.checked;
                updateSummary();
                saveToLocalStorage();
            });
            
            document.getElementById('layout-type').addEventListener('change', function() {
                currentSelections.layout.type = this.value;
                updateSummary();
                saveToLocalStorage();
            });
            
            document.getElementById('rush-checkbox').addEventListener('change', function() {
                currentSelections.rush.required = this.checked;
                updateSummary();
                saveToLocalStorage();
            });
            
            document.getElementById('rush-type').addEventListener('change', function() {
                currentSelections.rush.type = this.value;
                updateSummary();
                saveToLocalStorage();
            });
            
            document.getElementById('discount-checkbox').addEventListener('change', function() {
                currentSelections.discount = this.checked;
                updateSummary();
                saveToLocalStorage();
            });
            
            document.getElementById('location-select').addEventListener('change', function() {
                currentSelections.location = this.value;
                updateSummary();
                saveToLocalStorage();
            });
            
            document.getElementById('reset-button').addEventListener('click', resetSelections);
            document.getElementById('print-button').addEventListener('click', printQuote);
            document.getElementById('copy-button').addEventListener('click', copyQuotation);
            document.getElementById('copy-price-button').addEventListener('click', copyPriceSummary);
			// Import quotation button
			document.getElementById('import-button').addEventListener('click', importQuotation);

			// Also allow pressing Ctrl+Enter in the textarea
			document.getElementById('import-textarea').addEventListener('keydown', function(e) {
			if (e.ctrlKey && e.key === 'Enter') {
				importQuotation();
			}
			});
            
            updateSummary();
        });
        
        function setupOptionCards(containerId, selectionType, isEventType = false, isPaymentMethod = false) {
            const container = document.getElementById(containerId);
            const optionCards = container.querySelectorAll('.option-card');
            optionCards.forEach(card => {
                card.addEventListener('click', function() {
                    optionCards.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    const value = this.getAttribute('data-value');
                    
                    if (isPaymentMethod) {
                        currentSelections[selectionType] = value;
                    } else {
                        const price = parseInt(this.getAttribute('data-price'));
                        const name = this.querySelector('.option-name').textContent;
                        currentSelections[selectionType] = { value: value, price: price, name: name };
                    }
                    
                    if (isEventType) updateEventTypeTitle();
                    updateSummary();
                    saveToLocalStorage();
                });
            });
        }
        
        function initializeAddons() {
            const addonsGrid = document.getElementById('addons-grid');
            
            addonsData.forEach(addon => {
                const addonItem = document.createElement('div');
                addonItem.className = 'addon-item';
                addonItem.innerHTML = `
                    <div class="addon-header">
                        <input type="checkbox" class="addon-checkbox" id="addon-${addon.id}" data-id="${addon.id}" data-price="${addon.price}" data-unit="${addon.unit}">
                        <label class="addon-name" for="addon-${addon.id}">${addon.name}</label>
                    </div>
                    ${addon.unit !== 'flat' ? 
                        `<div class="addon-option">
                            <label>${addon.unit === 'page' ? 'Pages' : 'Pieces'}:</label>
                            <input type="number" class="addon-input" id="qty-${addon.id}" min="1" max="100" value="1" disabled>
                        </div>` 
                        : ''}
                `;
                addonsGrid.appendChild(addonItem);
                
                // Add event listeners for checkbox
                const checkbox = addonItem.querySelector('.addon-checkbox');
                const quantityInput = addonItem.querySelector('.addon-input');
                
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        if (quantityInput) quantityInput.disabled = false;
                        currentSelections.addons[addon.id] = {
                            name: addon.name,
                            price: addon.price,
                            unit: addon.unit,
                            quantity: quantityInput ? parseInt(quantityInput.value) || 1 : 1
                        };
                    } else {
                        if (quantityInput) {
                            quantityInput.disabled = true;
                            quantityInput.value = 1;
                        }
                        delete currentSelections.addons[addon.id];
                    }
                    updateSummary();
                    saveToLocalStorage();
                });
                
                // Add event listener for quantity input
                if (quantityInput) {
                    quantityInput.addEventListener('input', function() {
                        if (checkbox.checked) {
                            currentSelections.addons[addon.id].quantity = parseInt(this.value) || 1;
                            updateSummary();
                            saveToLocalStorage();
                        }
                    });
                }
            });
        }
        
        function updateEventTypeTitle() {
            const eventType = currentSelections.eventType.name;
            const title = eventType === "Special event" ? "Special event invitation" : `${eventType} invitation`;
            document.getElementById('event-type-title').textContent = title;
        }
        
        function updateEventDateDisplay() {
            if (eventDate) {
                const dateObj = new Date(eventDate);
                const formattedDate = dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                document.getElementById('event-date-display').textContent = `Event Date: ${formattedDate}`;
            } else {
                document.getElementById('event-date-display').textContent = ``;
            }
        }
        
        function calculateAddonsTotal() {
            let total = 0;
            let summaryHTML = '';
            
            Object.keys(currentSelections.addons).forEach(addonId => {
                const addon = currentSelections.addons[addonId];
                let addonTotal = 0;
                
                if (addon.unit === 'flat') {
                    addonTotal = addon.price;
                    // Show all flat add-ons in the main summary (they will be moved to one-time fees if needed)
                    summaryHTML += `<div class="summary-line">${addon.name}</div>`;
                } else if (addon.unit === 'page' || addon.unit === 'piece') {
                    addonTotal = addon.price * addon.quantity * numberOfSets;
                    // Format: "X page(s)/pc(s) Addon Name" with correct grammar
                    const unitText = addon.unit === 'page' ? (addon.quantity === 1 ? 'page' : 'pages') : 
                                    (addon.quantity === 1 ? 'pc' : 'pcs');
                    summaryHTML += `<div class="summary-line">${addon.quantity} ${unitText} ${addon.name}</div>`;
                }
                
                total += addonTotal;
            });
            
            document.getElementById('addons-summary').innerHTML = summaryHTML;
            return total;
        }
        
        function calculateShippingFee(totalAmount) {
            if (totalAmount >= 3000) {
                return 0; // FREE shipping
            } else if (totalAmount >= 2000) {
                return 50; // ₱50 shipping
            } else {
                return 100; // ₱100 shipping
            }
        }
        
        function calculateFreeSetsForDirectShipping(setsCount) {
            if (setsCount >= 100) {
                return Math.floor(setsCount / 20);
            } else if (setsCount >= 75) {
                return 3;
            } else if (setsCount >= 50) {
                return 2;
            } else if (setsCount >= 30) {
                return 1;
            } else {
                return 0;
            }
        }
        
        function roundToWholeNumber(amount) {
            return Math.round(amount);
        }
        
        function updateSummary() {
            const sizePrice = currentSelections.size.price;
            const envelopePrice = currentSelections.envelope.price;
            const insertsPrice = currentSelections.inserts.price;
            const paperPrice = currentSelections.paper.price;
            const sealPrice = currentSelections.seal.price;
            
            // Fix for envelope display
			let envelopeDisplay = "";
			const envelopeName = currentSelections.envelope.name;

			if (envelopeName === "No envelope") {
				envelopeDisplay = "No envelope";
			} else {
				if (currentSelections.envelope.custom && 
					(currentSelections.envelope.color || currentSelections.envelope.texture)) {
					// Build custom envelope display
					const parts = [];
					if (currentSelections.envelope.color) parts.push(currentSelections.envelope.color);
					if (currentSelections.envelope.texture) parts.push(currentSelections.envelope.texture);
					parts.push(envelopeName);
        
					envelopeDisplay = parts.join(' ') + " Envelope";
				} else {
					envelopeDisplay = `${envelopeName} Envelope`;
				}
			}

			// Update the display
			document.getElementById('summary-envelope-line').textContent = envelopeDisplay;
            
            // Calculate add-ons total
            calculateAddonsTotal();
            
            // Calculate additional pages for inserts more than 4
            let additionalPagesText = "";
            const insertsCount = currentSelections.inserts.value;
            if (insertsCount > 4) {
                const additionalPages = insertsCount - 4;
                additionalPagesText = `${additionalPages} page${additionalPages > 1 ? 's' : ''} add`;
            }
            
            // Calculate layout fee based on number of inserts (pages)
            const numberOfPages = currentSelections.inserts.value + 1; // Base invitation + inserts
            
            // Calculate layout fee according to new rules (200 for 0-1 insert, 300 for 2 inserts, etc.)
            let layoutFee = 0;
            let layoutSummary = "";
            
            // Calculate layout fee based on inserts count
            if (currentSelections.inserts.value <= 1) {
                layoutFee = 200;
            } else {
                layoutFee = 200 + ((currentSelections.inserts.value - 1) * 100);
            }
            
            // Apply layout rules based on checkbox and layout type - ALWAYS SHOW LAYOUT INFO
            if (!currentSelections.layout.required) {
                // Box unchecked
                if (currentSelections.layout.type === "own-layout") {
                    layoutSummary = "Own layout";
                    layoutFee = 0;
                } else if (currentSelections.layout.type === "no-layout") {
                    if (numberOfSets >= 20) {
                        layoutSummary = "FREE layout";
                        layoutFee = 0;
                    } else {
                        layoutSummary = `Layout fee: ₱${layoutFee}`;
                    }
                }
            } else {
                // Box checked
                if (currentSelections.layout.type === "own-layout") {
                    layoutSummary = "Own layout";
                    layoutFee = 0;
                } else if (currentSelections.layout.type === "no-layout") {
                    layoutSummary = `Layout fee: ₱${layoutFee}`;
                }
            }
            
            // Calculate rush fee
            let rushFee = 0;
            let rushSummary = "";
            if (currentSelections.rush.required) {
                if (currentSelections.rush.type === "own-layout") {
                    rushFee = 10 * numberOfSets;
                    rushSummary = `Rush fee: ₱${rushFee}`;
                } else if (currentSelections.rush.type === "no-layout") {
                    rushFee = 100 + (10 * numberOfSets);
                    rushSummary = `Rush fee: ₱${rushFee}`;
                }
            }
            
            // Calculate price per set (including flat add-ons except Map layout)
            let addonPricePerSet = 0;
            Object.keys(currentSelections.addons).forEach(addonId => {
                const addon = currentSelections.addons[addonId];
                
                if (addonId === 'map-layout') {
                    // Map layout is NOT included in price per set (it's a one-time fee)
                    return;
                }
                
                if (addon.unit === 'flat') {
                    // Check if this flat add-on should be included in price per set
                    if (flatAddonsInPricePerSet.includes(addonId)) {
                        // These flat add-ons are included in price per set
                        addonPricePerSet += addon.price;
                    }
                    // Note: flat add-ons NOT in the list are treated as one-time fees
                } else {
                    // For per-page/per-piece add-ons, add their price to price per set
                    addonPricePerSet += addon.price * addon.quantity;
                }
            });
            
            const totalPerSet = BASE_PRICE + sizePrice + envelopePrice + insertsPrice + paperPrice + sealPrice + addonPricePerSet;
            
            // Calculate sets total (price for all sets)
            let payableSets = numberOfSets;
            let freeSets = 0;
            
            // Apply discount logic - for both direct-shipping and show all
			if (currentSelections.discount && (currentSelections.paymentMethod === "direct-shipping" || currentSelections.paymentMethod === "none")) {
				// Calculate free sets but don't give them for free, instead reduce payable sets
				freeSets = calculateFreeSetsForDirectShipping(numberOfSets);
				payableSets = numberOfSets - freeSets;
			} else {
				// Normal calculation
				payableSets = numberOfSets;
			}
            const setsTotal = totalPerSet * payableSets;
            
            // Calculate one-time fees (Map layout, layout fee, rush fee, and flat add-ons NOT in price per set)
            let oneTimeFeesTotal = 0;
            let oneTimeFeesHTML = "";
            
            Object.keys(currentSelections.addons).forEach(addonId => {
                const addon = currentSelections.addons[addonId];
                
                if (addonId === 'map-layout') {
                    // Map layout is always a one-time fee
                    oneTimeFeesTotal += addon.price;
                    oneTimeFeesHTML += `<div class="summary-line">Map layout: ₱${addon.price}</div>`;
                } else if (addon.unit === 'flat' && !flatAddonsInPricePerSet.includes(addonId)) {
                    // Flat add-ons NOT in the price-per-set list are one-time fees
                    oneTimeFeesTotal += addon.price;
                    oneTimeFeesHTML += `<div class="summary-line">${addon.name}: ₱${addon.price}</div>`;
                }
            });
			
			// Add additional pages text if applicable - THIS GOES BEFORE SETS TOTAL
            if (additionalPagesText) {
                oneTimeFeesHTML += `<div class="summary-line">${additionalPagesText}</div>`;
            }
            
            // Add layout fee to one-time fees if applicable - ALWAYS SHOW LAYOUT INFO
            if (layoutSummary) {
                if (layoutSummary.startsWith("Layout fee:")) {
                    oneTimeFeesTotal += layoutFee;
                    oneTimeFeesHTML += `<div class="summary-line">${layoutSummary}</div>`;
                } else {
                    // Show "FREE layout" or "Own layout" even without fee
                    oneTimeFeesHTML += `<div class="summary-line">${layoutSummary}</div>`;
                }
            }
            
            // Add rush fee to one-time fees if applicable
            if (rushSummary) {
                oneTimeFeesTotal += rushFee;
                oneTimeFeesHTML += `<div class="summary-line">${rushSummary}</div>`;
            }
            
            
            const finalTotal = setsTotal + oneTimeFeesTotal;
            
            // Update display
            document.getElementById('price-per-set').textContent = `₱${totalPerSet} each`;
            document.getElementById('summary-size-line').textContent = `${currentSelections.size.name} size`;
            document.getElementById('summary-envelope-line').textContent = envelopeDisplay;
            document.getElementById('summary-inserts-line').textContent = `${currentSelections.inserts.value} insert${currentSelections.inserts.value !== 1 ? 's' : ''}`;
            document.getElementById('summary-paper-line').textContent = `${currentSelections.paper.name} paper`;
            document.getElementById('summary-seal-line').textContent = currentSelections.seal.name;
            
			// Update sets total display with discount logic
			let setsTotalHTML = '';
			if (currentSelections.discount && freeSets > 0 && (currentSelections.paymentMethod === "direct-shipping" || currentSelections.paymentMethod === "none")) {
				setsTotalHTML = `${numberOfSets} sets (pay for ${payableSets}) x ₱${totalPerSet} each = ₱${setsTotal}`;
			} else {
				setsTotalHTML = `${numberOfSets} sets x ₱${totalPerSet} each = ₱${setsTotal}`;
			}

			document.getElementById('sets-total').innerHTML = setsTotalHTML;
            
            // Update one-time fees section (now placed before sets total)
            if (oneTimeFeesHTML) {
                document.getElementById('one-time-fees').innerHTML = oneTimeFeesHTML;
                document.getElementById('one-time-fees').style.display = 'block';
            } else {
                document.getElementById('one-time-fees').innerHTML = '';
                document.getElementById('one-time-fees').style.display = 'none';
            }
            
            document.getElementById('final-total').innerHTML = `Total: ₱${finalTotal}`;
            
            // Update payment methods section
            updatePaymentMethods(finalTotal, setsTotal, oneTimeFeesTotal, payableSets, freeSets);
        }
        
        function updatePaymentMethods(finalTotal, setsTotal, oneTimeFeesTotal, payableSets, freeSets) {
            const paymentMethodsSection = document.getElementById('payment-methods-section');
            const locationName = currentSelections.location ? locationNames[currentSelections.location] : '';
            const shippingFee = calculateShippingFee(finalTotal);
            
            // Calculate free sets for display (for non-discount case)
            const displayFreeSets = currentSelections.discount ? 0 : calculateFreeSetsForDirectShipping(numberOfSets);
            
            let paymentMethodsHTML = '';
            
            // Calculate downpayment (50% of final total including shipping)
            const downpayment = roundToWholeNumber(finalTotal / 2);
            const balance = finalTotal - downpayment;
            const shopeeCOD = roundToWholeNumber(balance * 1.15); // 15% additional for COD
            
            // Show payment methods based on selection
            if (currentSelections.paymentMethod === "none") {
                // Show both Direct Shipping and Shopee Checkout
                paymentMethodsHTML += `
                    <div class="payment-method-option">
                        <div class="payment-method-title">Direct shipping</div>
                        <div class="payment-method-details">
                            Downpayment: ₱${downpayment}<br>
                            Balance before ship out: ₱${balance}<br>
                            ${displayFreeSets > 0 ? `FREE ${displayFreeSets} set${displayFreeSets > 1 ? 's' : ''}<br>` : ''}
                            ${shippingFee > 0 ? `+ ₱${shippingFee} Shipping fee` : 'FREE Shipping'}
                        </div>
                    </div>
                    <div class="payment-method-option">
                        <div class="payment-method-title">Shopee Checkout (15% add)</div>
                        <div class="payment-method-details">
                            Downpayment: ₱${downpayment}<br>
                            COD: ₱${shopeeCOD} ${shippingFee > 0 ? `+ shipping fee` : ''}
                        </div>
                    </div>
                `;
            } else if (currentSelections.paymentMethod === "direct-shipping") {
                // Show only Direct Shipping
                paymentMethodsHTML += `
                    <div class="payment-method-option">
                        <div class="payment-method-title">Direct shipping</div>
                        <div class="payment-method-details">
                            Downpayment: ₱${downpayment}<br>
                            Balance before ship out: ₱${balance}<br>
                            ${displayFreeSets > 0 ? `FREE ${displayFreeSets} set${displayFreeSets > 1 ? 's' : ''}<br>` : ''}
                            ${shippingFee > 0 ? `+ ₱${shippingFee} Shipping fee` : 'FREE Shipping'}
                        </div>
                    </div>
                `;
            } else if (currentSelections.paymentMethod === "shopee-checkout") {
                // Show only Shopee Checkout (COD)
                paymentMethodsHTML += `
                    <div class="payment-method-option">
                        <div class="payment-method-title">Shopee Checkout (15% add)</div>
                        <div class="payment-method-details">
                            Downpayment: ₱${downpayment}<br>
                            COD: ₱${shopeeCOD} ${shippingFee > 0 ? `+ shipping fee` : ''}
                        </div>
                    </div>
                `;
            } else if (currentSelections.paymentMethod === "shopee-checkout-full") {
                // Show only Shopee Checkout Full Payment
                paymentMethodsHTML += `
                    <div class="payment-method-option">
                        <div class="payment-method-title">Shopee Checkout Full Payment</div>
                        <div class="payment-method-details">
                            Full Payment: ₱${finalTotal} ${shippingFee > 0 ? `+ shipping fee` : ''}
                        </div>
                    </div>
                `;
            }
            
            // Add discount note if applicable
            if (currentSelections.discount && freeSets > 0) {
                paymentMethodsHTML += `<div class="payment-method-details" style="margin-top: 8px; color: #666; font-style: italic; font-size: 0.8rem;">
                    Discount applied: Pay for ${payableSets} sets, receive ${numberOfSets} sets
                </div>`;
            }
            
            // Add location if specified
            if (locationName) {
                paymentMethodsHTML += `<div class="payment-method-details" style="margin-top: 8px; font-weight: 500; font-size: 0.85rem;">Location: ${locationName}</div>`;
            }
            
            paymentMethodsSection.innerHTML = paymentMethodsHTML;
        }
        
        function saveToLocalStorage() {
            const saveData = {
                currentSelections: currentSelections,
                numberOfSets: numberOfSets,
                eventDate: eventDate
            };
            localStorage.setItem('invitationCalculatorData', JSON.stringify(saveData));
        }
        
        function loadSavedData() {
            const savedData = localStorage.getItem('invitationCalculatorData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    
                    // Restore basic data
                    if (data.numberOfSets) numberOfSets = data.numberOfSets;
                    if (data.eventDate) eventDate = data.eventDate;
                    
                    // Restore currentSelections if available
                    if (data.currentSelections) {
                        currentSelections = data.currentSelections;
                        
                        // Update UI elements based on saved data
                        updateUIFromSavedData();
                    }
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }
        
        function updateUIFromSavedData() {
            // Update event type
            const eventTypeCards = document.querySelectorAll('#event-type-options .option-card');
            eventTypeCards.forEach(card => {
                if (card.getAttribute('data-value') === currentSelections.eventType.value) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
            updateEventTypeTitle();
            
            // Update size
            const sizeCards = document.querySelectorAll('#size-options .option-card');
            sizeCards.forEach(card => {
                if (card.getAttribute('data-value') === currentSelections.size.value) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
            
            // Update envelope
            const envelopeCards = document.querySelectorAll('#envelope-options .option-card');
            envelopeCards.forEach(card => {
                if (card.getAttribute('data-value') === currentSelections.envelope.value) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
			
			// Update envelope customization UI
			if (currentSelections.envelope) {
				document.getElementById('envelope-checkbox').checked = currentSelections.envelope.custom || false;
				document.getElementById('color-select').value = currentSelections.envelope.color || "";
				document.getElementById('texture-select').value = currentSelections.envelope.texture || "";
			}
            
            // Update inserts slider
            document.getElementById('inserts-slider').value = currentSelections.inserts.value;
            document.getElementById('inserts-value').textContent = `${currentSelections.inserts.value} insert${currentSelections.inserts.value !== 1 ? 's' : ''}`;
            
            // Update paper
            const paperCards = document.querySelectorAll('#paper-options .option-card');
            paperCards.forEach(card => {
                if (card.getAttribute('data-value') === currentSelections.paper.value) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
            
            // Update seal
            const sealCards = document.querySelectorAll('#seal-options .option-card');
            sealCards.forEach(card => {
                if (card.getAttribute('data-value') === currentSelections.seal.value) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
            
            // Update layout checkbox and dropdown
            document.getElementById('layout-checkbox').checked = currentSelections.layout.required;
            document.getElementById('layout-type').value = currentSelections.layout.type;
            
            // Update rush checkbox and dropdown
            document.getElementById('rush-checkbox').checked = currentSelections.rush.required;
            document.getElementById('rush-type').value = currentSelections.rush.type;
			
			// Update layout dropdown
			if (currentSelections.layout && currentSelections.layout.type) {
				document.getElementById('layout-type').value = currentSelections.layout.type;
			}

			// Update rush dropdown
			if (currentSelections.rush && currentSelections.rush.type) {
				document.getElementById('rush-type').value = currentSelections.rush.type;
			}
            
            // Update discount checkbox
            document.getElementById('discount-checkbox').checked = currentSelections.discount;
            
            // Update payment method
            const paymentMethodCards = document.querySelectorAll('#payment-method-options .option-card');
            paymentMethodCards.forEach(card => {
                if (card.getAttribute('data-value') === currentSelections.paymentMethod) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
            
            // Update location
            document.getElementById('location-select').value = currentSelections.location;
            
            // Update sets input
            document.getElementById('sets-input').value = numberOfSets;
            
            // Update event date
            document.getElementById('event-date-input').value = eventDate;
            updateEventDateDisplay();
            
            // Update add-ons (need to wait for DOM to be ready)
            setTimeout(() => {
                if (currentSelections.addons) {
                    Object.keys(currentSelections.addons).forEach(addonId => {
                        const checkbox = document.getElementById(`addon-${addonId}`);
                        if (checkbox) {
                            checkbox.checked = true;
                            const quantityInput = document.getElementById(`qty-${addonId}`);
                            if (quantityInput) {
                                quantityInput.disabled = false;
                                quantityInput.value = currentSelections.addons[addonId].quantity;
                            }
                        }
                    });
                }
            }, 100);
        }
        
        function resetSelections() {
            const eventTypeCards = document.querySelectorAll('#event-type-options .option-card');
            eventTypeCards.forEach(card => card.classList.remove('selected'));
            eventTypeCards[0].classList.add('selected');
            currentSelections.eventType = { value: "wedding", price: 0, name: "Wedding" };
            updateEventTypeTitle();
            
            const sizeCards = document.querySelectorAll('#size-options .option-card');
            sizeCards.forEach(card => card.classList.remove('selected'));
            sizeCards[0].classList.add('selected');
            currentSelections.size = { value: "4r", price: 0, name: "4R" };
            
            const envelopeCards = document.querySelectorAll('#envelope-options .option-card');
            envelopeCards.forEach(card => card.classList.remove('selected'));
            envelopeCards[1].classList.add('selected');
            currentSelections.envelope = { value: "plain-white", price: 0, name: "Plain white", custom: false, color: "", texture: "" };
            
            document.getElementById('inserts-slider').value = 0;
            document.getElementById('inserts-value').textContent = '0 inserts';
            currentSelections.inserts = { value: 0, price: 0 };
            
            const paperCards = document.querySelectorAll('#paper-options .option-card');
            paperCards.forEach(card => card.classList.remove('selected'));
            paperCards[0].classList.add('selected');
            currentSelections.paper = { value: "matte", price: 0, name: "Matte" };
            
            const sealCards = document.querySelectorAll('#seal-options .option-card');
            sealCards.forEach(card => card.classList.remove('selected'));
            sealCards[0].classList.add('selected');
            currentSelections.seal = { value: "no-seal", price: 0, name: "No seal" };
            
            // Reset add-ons
            document.querySelectorAll('.addon-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.querySelectorAll('.addon-input').forEach(input => {
                input.value = 1;
                input.disabled = true;
            });
            currentSelections.addons = {};
            
            document.getElementById('envelope-checkbox').checked = false;
			document.getElementById('color-select').value = "";
			document.getElementById('texture-select').value = "";
			document.getElementById('layout-checkbox').checked = false;
            document.getElementById('layout-type').value = "no-layout";
            document.getElementById('rush-checkbox').checked = false;
            document.getElementById('rush-type').value = "no-layout";
            document.getElementById('discount-checkbox').checked = false;
            currentSelections.layout = { required: false, type: "no-layout", pages: 1 };
            currentSelections.rush = { required: false, type: "no-layout" };
            currentSelections.discount = false;
            
            // Reset layout and rush dropdowns
			document.getElementById('layout-type').value = "no-layout";
			document.getElementById('rush-type').value = "no-layout";
			currentSelections.layout = { required: false, type: "no-layout", pages: 1 };
			currentSelections.rush = { required: false, type: "no-layout" };
			
			// Reset payment method
            const paymentMethodCards = document.querySelectorAll('#payment-method-options .option-card');
            paymentMethodCards.forEach(card => card.classList.remove('selected'));
            paymentMethodCards[0].classList.add('selected');
            currentSelections.paymentMethod = "none";
            
            // Reset location
            document.getElementById('location-select').value = "";
            currentSelections.location = "";
            
            document.getElementById('sets-input').value = 20;
            numberOfSets = 20;
			
			// Clear import textarea
			document.getElementById('import-textarea').value = "";
            
            // Clear event date
            document.getElementById('event-date-input').value = "";
            eventDate = "";
            updateEventDateDisplay();
            
            // Clear localStorage
            localStorage.removeItem('invitationCalculatorData');
            
            updateSummary();
            alert("All selections have been reset to default values.");
        }
        
        function copyPriceSummary() {
    // Get price per set
    const totalPerSet = parseInt(document.getElementById('price-per-set').textContent.replace('₱', '').replace(' each', ''));
    
    // Get all inclusions
    const sizeText = document.getElementById('summary-size-line').textContent;
    const envelopeText = document.getElementById('summary-envelope-line').textContent;
    const insertsText = document.getElementById('summary-inserts-line').textContent;
    const paperText = document.getElementById('summary-paper-line').textContent;
    const sealText = document.getElementById('summary-seal-line').textContent;
    
    // Get add-ons summary (included in price per set)
    let addonsInPricePerSet = '';
    Object.keys(currentSelections.addons).forEach(addonId => {
        const addon = currentSelections.addons[addonId];
        
        if (addonId === 'map-layout') {
            // Map layout is NOT included in price per set
            return;
        }
        
        if (addon.unit === 'flat') {
            // Check if this flat add-on should be included in price per set
            if (flatAddonsInPricePerSet.includes(addonId)) {
                // These flat add-ons are included in price per set
                if (addonsInPricePerSet) addonsInPricePerSet += "\n";
                addonsInPricePerSet += `${addon.name}`;
            }
        } else {
            // For per-page/per-piece add-ons, add their price to price per set
            // Format: "X page(s)/pc(s) Addon Name" with correct grammar
            const unitText = addon.unit === 'page' ? (addon.quantity === 1 ? 'page' : 'pages') : 
                            (addon.quantity === 1 ? 'pc' : 'pcs');
            if (addonsInPricePerSet) addonsInPricePerSet += "\n";
            addonsInPricePerSet += `${addon.quantity} ${unitText} ${addon.name}`;
        }
    });
    
    // Build price summary text with NO extra spaces
    let priceSummaryText = `₱${totalPerSet} each`;
    priceSummaryText += `\n\n${sizeText}`;
    priceSummaryText += `\n${envelopeText}`;
    priceSummaryText += `\n${insertsText}`;
    priceSummaryText += `\n${paperText}`;
    priceSummaryText += `\n${sealText}`;
    
    if (addonsInPricePerSet) {
        priceSummaryText += `\n${addonsInPricePerSet}`;
    }
    
    
    
    navigator.clipboard.writeText(priceSummaryText).then(() => {
        const notification = document.getElementById('price-notification');
        notification.classList.add('show');
        setTimeout(() => notification.classList.remove('show'), 3000);
    }).catch(err => {
        console.error('Failed to copy: ', err);
        alert('Failed to copy price summary to clipboard. Please try again.');
    });
}
        
function copyQuotation() {
    const sizePrice = currentSelections.size.price;
    const envelopePrice = currentSelections.envelope.price;
    const insertsPrice = currentSelections.inserts.price;
    const paperPrice = currentSelections.paper.price;
    const sealPrice = currentSelections.seal.price;
    
    // Calculate add-ons total and summary
    let addonsSummary = "";
    
    Object.keys(currentSelections.addons).forEach(addonId => {
        const addon = currentSelections.addons[addonId];
        
        if (addon.unit === 'flat') {
            // Show all flat add-ons in the main summary
            addonsSummary += `${addon.name}\n`;
        } else if (addon.unit === 'page' || addon.unit === 'piece') {
            // Format: "X page(s)/pc(s) Addon Name" with correct grammar
            const unitText = addon.unit === 'page' ? (addon.quantity === 1 ? 'page' : 'pages') : 
                            (addon.quantity === 1 ? 'pc' : 'pcs');
            addonsSummary += `${addon.quantity} ${unitText} ${addon.name}\n`;
        }
    });
    
    // Calculate additional pages for inserts more than 4
    let additionalPagesText = "";
    const insertsCount = currentSelections.inserts.value;
    if (insertsCount > 4) {
        const additionalPages = insertsCount - 4;
        additionalPagesText = `${additionalPages} page${additionalPages > 1 ? 's' : ''} add`;
    }
    
    // Calculate layout fee based on number of inserts (pages)
    let layoutFee = 0;
    let layoutSummary = "";
    
    // Calculate layout fee based on inserts count
    if (currentSelections.inserts.value <= 1) {
        layoutFee = 200;
    } else {
        layoutFee = 200 + ((currentSelections.inserts.value - 1) * 100);
    }
    
    // Apply layout rules based on checkbox and layout type
    if (!currentSelections.layout.required) {
        // Box unchecked
        if (currentSelections.layout.type === "own-layout") {
            layoutSummary = "Own layout";
            layoutFee = 0;
        } else if (currentSelections.layout.type === "no-layout") {
            if (numberOfSets >= 20) {
                layoutSummary = "FREE layout";
                layoutFee = 0;
            } else {
                layoutSummary = `Layout fee: ₱${layoutFee}`;
            }
        }
    } else {
        // Box checked
        if (currentSelections.layout.type === "own-layout") {
            layoutSummary = "Own layout";
            layoutFee = 0;
        } else if (currentSelections.layout.type === "no-layout") {
            layoutSummary = `Layout fee: ₱${layoutFee}`;
        }
    }
    
    let rushFee = 0;
    let rushSummary = "";
    if (currentSelections.rush.required) {
        if (currentSelections.rush.type === "own-layout") {
            rushFee = 10 * numberOfSets;
            rushSummary = `Rush fee: ₱${rushFee}`;
        } else if (currentSelections.rush.type === "no-layout") {
            rushFee = 100 + (10 * numberOfSets);
            rushSummary = `Rush fee: ₱${rushFee}`;
        }
    }
    
    // Calculate price per set (including flat add-ons except Map layout)
    let addonPricePerSet = 0;
    Object.keys(currentSelections.addons).forEach(addonId => {
        const addon = currentSelections.addons[addonId];
        
        if (addonId === 'map-layout') {
            // Map layout is NOT included in price per set (it's a one-time fee)
            return;
        }
        
        if (addon.unit === 'flat') {
            // Check if this flat add-on should be included in price per set
            if (flatAddonsInPricePerSet.includes(addonId)) {
                // These flat add-ons are included in price per set
                addonPricePerSet += addon.price;
            }
        } else {
            // For per-page/per-piece add-ons, add their price to price per set
            addonPricePerSet += addon.price * addon.quantity;
        }
    });
    
    const totalPerSet = BASE_PRICE + sizePrice + envelopePrice + insertsPrice + paperPrice + sealPrice + addonPricePerSet;
    
    // Calculate sets total (price for all sets)
    let payableSets = numberOfSets;
    let freeSets = 0;
    
    // Apply discount logic
    if (currentSelections.paymentMethod === "direct-shipping" || currentSelections.paymentMethod === "none") {
        // Calculate free sets but don't give them for free, instead reduce payable sets
        freeSets = calculateFreeSetsForDirectShipping(numberOfSets);
	}	
		// If discount is checked AND payment method is direct-shipping or show all, subtract free sets
if (currentSelections.discount && (currentSelections.paymentMethod === "direct-shipping" || currentSelections.paymentMethod === "none")) {
    payableSets = numberOfSets - freeSets;
} else {
        // Normal calculation
        payableSets = numberOfSets;
    }
    
    const setsTotal = totalPerSet * payableSets;
    
    // Calculate one-time fees (Map layout, layout fee, rush fee, and flat add-ons NOT in price per set)
    let oneTimeFeesTotal = 0;
    let oneTimeFeesText = "";
    
    Object.keys(currentSelections.addons).forEach(addonId => {
        const addon = currentSelections.addons[addonId];
        
        if (addonId === 'map-layout') {
            // Map layout is always a one-time fee
            oneTimeFeesTotal += addon.price;
            oneTimeFeesText += `Map layout: ₱${addon.price}\n`;
        } else if (addon.unit === 'flat' && !flatAddonsInPricePerSet.includes(addonId)) {
            // Flat add-ons NOT in the price-per-set list are one-time fees
            oneTimeFeesTotal += addon.price;
            oneTimeFeesText += `${addon.name}: ₱${addon.price}\n`;
        }
    });
    
    // Add layout fee to one-time fees if applicable - ALWAYS SHOW LAYOUT INFO
    if (layoutSummary) {
        if (layoutSummary.startsWith("Layout fee:")) {
            oneTimeFeesTotal += layoutFee;
            oneTimeFeesText += `${layoutSummary}\n`;
        } else {
            // Show "FREE layout" or "Own layout" even without fee
            oneTimeFeesText += `${layoutSummary}\n`;
        }
    }
    
    // Add rush fee to one-time fees if applicable
    if (rushSummary) {
        oneTimeFeesTotal += rushFee;
        oneTimeFeesText += `${rushSummary}\n`;
    }
    
    
    
    const finalTotal = setsTotal + oneTimeFeesTotal;
    
    // Calculate payment details - NEW LOGIC: For direct shipping, subtract free sets from total
    const shippingFee = calculateShippingFee(finalTotal);
    const displayFreeSets = currentSelections.discount ? 0 : calculateFreeSetsForDirectShipping(numberOfSets);
    const downpayment = roundToWholeNumber(finalTotal / 2);
    const balance = finalTotal - downpayment;
    const shopeeCOD = roundToWholeNumber(balance * 1.15); // 15% additional for COD
    
    const eventType = currentSelections.eventType.name;
    const eventTitle = eventType === "Special event" ? "Special event invitation" : `${eventType} invitation`;
    
    let formattedEventDate = "";
    if (eventDate) {
        const dateObj = new Date(eventDate);
        formattedEventDate = dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    }
    
    // Fix envelope display
    const envelopeName = currentSelections.envelope.name;
    let envelopeDisplay = "";

    if (envelopeName === "No envelope") {
        envelopeDisplay = "No envelope";
    } else if (currentSelections.envelope.custom) {
        // Format: "Color Texture Envelope Name Envelope"
        // Example: "Blue Matte Premium colored Envelope"
        envelopeDisplay = `${currentSelections.envelope.color} ${currentSelections.envelope.texture} ${envelopeName} Envelope`;
    } else {
        envelopeDisplay = `${envelopeName} Envelope`;
    }
    
    // Build quotation text with proper formatting
    let quotationText = `${eventTitle}`;
    
    if (formattedEventDate) {
        quotationText += `\nEvent Date: ${formattedEventDate}`;
    }
    
    quotationText += `\n\n₱${totalPerSet} each\n\n`;
    quotationText += `${currentSelections.size.name} size\n`;
    quotationText += `${envelopeDisplay}\n`;
    quotationText += `${currentSelections.inserts.value} insert${currentSelections.inserts.value !== 1 ? 's' : ''}\n`;
    quotationText += `${currentSelections.paper.name} paper\n`;
    quotationText += `${currentSelections.seal.name}\n`;
    
    if (addonsSummary) {
        quotationText += `\n${addonsSummary}`;
    }
	
	// Add additional pages text if applicable
    if (additionalPagesText) {
        quotationText += `${additionalPagesText}`;
    }
    
	// Handle sets total
	let setsTotalText = '';
	if (currentSelections.discount && freeSets > 0 && (currentSelections.paymentMethod === "direct-shipping" || currentSelections.paymentMethod === "none")) {
		setsTotalText = `${numberOfSets} sets (pay for ${payableSets}) x ₱${totalPerSet} each = ₱${setsTotal}`;
	} else {
		setsTotalText = `${numberOfSets} sets x ₱${totalPerSet} each = ₱${setsTotal}`;
	}
    quotationText += `\n\n${setsTotalText}`;
    
    // Add layout, rush, and additional pages info (remove empty lines from oneTimeFeesText)
    if (oneTimeFeesText.trim()) {
        // Add a single newline before the layout/rush info
        quotationText += `\n${oneTimeFeesText.trim()}`;
    }
    
    quotationText += `\n\nTotal: ₱${finalTotal}`;
    
    // Add payment methods based on selection
    quotationText += `\n\nPayment method`;
    
    if (currentSelections.paymentMethod === "none") {
        // Show both Direct Shipping and Shopee Checkout
        quotationText += `\n\nDirect shipping\n\n`;
        quotationText += `Downpayment: ₱${downpayment}\n`;
        quotationText += `Balance before ship out: ₱${balance}`;
        if (displayFreeSets > 0) {
            quotationText += `\nFREE ${displayFreeSets} set${displayFreeSets > 1 ? 's' : ''}`;
        }
        if (shippingFee > 0) {
            quotationText += `\n+ ₱${shippingFee} Shipping fee`;
        } else {
            quotationText += `\nFREE Shipping`;
        }
        
        quotationText += `\n\nShopee Checkout (15% add)\n\n`;
        quotationText += `Downpayment: ₱${downpayment}\n`;
        quotationText += `COD: ₱${shopeeCOD}`;
        if (shippingFee > 0) {
            quotationText += ` + shipping fee`;
        }
    } else if (currentSelections.paymentMethod === "direct-shipping") {
        // Show only Direct Shipping
        quotationText += `\n\nDirect shipping\n\n`;
        quotationText += `Downpayment: ₱${downpayment}\n`;
        quotationText += `Balance before ship out: ₱${balance}`;
        if (displayFreeSets > 0) {
            quotationText += `\nFREE ${displayFreeSets} set${displayFreeSets > 1 ? 's' : ''}`;
        }
        if (shippingFee > 0) {
            quotationText += `\n+ ₱${shippingFee} Shipping fee`;
        } else {
            quotationText += `\nFREE Shipping`;
        }
    } else if (currentSelections.paymentMethod === "shopee-checkout") {
        // Show only Shopee Checkout (COD)
        quotationText += `\n\nShopee Checkout (15% add)\n\n`;
        quotationText += `Downpayment: ₱${downpayment}\n`;
        quotationText += `COD: ₱${shopeeCOD}`;
        if (shippingFee > 0) {
            quotationText += ` + shipping fee`;
        }
    } else if (currentSelections.paymentMethod === "shopee-checkout-full") {
        // Show only Shopee Checkout Full Payment
        quotationText += `\n\nShopee Checkout Full Payment\n\n`;
        quotationText += `Full Payment: ₱${finalTotal}`;
        if (shippingFee > 0) {
            quotationText += ` + shipping fee`;
        }
    }
    
    // Add discount note if applicable
    if (currentSelections.discount && freeSets > 0) {
        quotationText += `\n\nDiscount applied: Pay for ${payableSets} sets, receive ${numberOfSets} sets`;
    }
    
    // Add location if specified
    const locationName = currentSelections.location ? locationNames[currentSelections.location] : '';
    if (locationName) {
        quotationText += `\n\nLocation: ${locationName}`;
    }
    
    
   
    navigator.clipboard.writeText(quotationText).then(() => {
        const notification = document.getElementById('notification');
        notification.classList.add('show');
        setTimeout(() => notification.classList.remove('show'), 3000);
    }).catch(err => {
        console.error('Failed to copy: ', err);
        alert('Failed to copy quotation to clipboard. Please try again.');
    });
}
        
        function resetSelectionsOnly() {
    const eventTypeCards = document.querySelectorAll('#event-type-options .option-card');
    eventTypeCards.forEach(card => card.classList.remove('selected'));
    eventTypeCards[0].classList.add('selected');
    currentSelections.eventType = { value: "wedding", price: 0, name: "Wedding" };
    updateEventTypeTitle();
    
    const sizeCards = document.querySelectorAll('#size-options .option-card');
    sizeCards.forEach(card => card.classList.remove('selected'));
    sizeCards[0].classList.add('selected');
    currentSelections.size = { value: "4r", price: 0, name: "4R" };
    
    const envelopeCards = document.querySelectorAll('#envelope-options .option-card');
    envelopeCards.forEach(card => card.classList.remove('selected'));
    envelopeCards[1].classList.add('selected');
    currentSelections.envelope = { value: "plain-white", price: 0, name: "Plain white", custom: false, color: "", texture: "" };
    
    document.getElementById('inserts-slider').value = 0;
    document.getElementById('inserts-value').textContent = '0 inserts';
    currentSelections.inserts = { value: 0, price: 0 };
    
    const paperCards = document.querySelectorAll('#paper-options .option-card');
    paperCards.forEach(card => card.classList.remove('selected'));
    paperCards[0].classList.add('selected');
    currentSelections.paper = { value: "matte", price: 0, name: "Matte" };
    
    const sealCards = document.querySelectorAll('#seal-options .option-card');
    sealCards.forEach(card => card.classList.remove('selected'));
    sealCards[0].classList.add('selected');
    currentSelections.seal = { value: "no-seal", price: 0, name: "No seal" };
    
    // Reset add-ons
    document.querySelectorAll('.addon-checkbox').forEach(checkbox => {
        checkbox.checked = false;
    });
    document.querySelectorAll('.addon-input').forEach(input => {
        input.value = 1;
        input.disabled = true;
    });
    currentSelections.addons = {};
    
    document.getElementById('envelope-checkbox').checked = false;
    document.getElementById('color-select').value = "";
    document.getElementById('texture-select').value = "";
    document.getElementById('layout-checkbox').checked = false;
    document.getElementById('layout-type').value = "no-layout";
    document.getElementById('rush-checkbox').checked = false;
    document.getElementById('rush-type').value = "no-layout";
    document.getElementById('discount-checkbox').checked = false;
    currentSelections.layout = { required: false, type: "no-layout", pages: 1 };
    currentSelections.rush = { required: false, type: "no-layout" };
    currentSelections.discount = false;
    
    // Reset payment method
    const paymentMethodCards = document.querySelectorAll('#payment-method-options .option-card');
    paymentMethodCards.forEach(card => card.classList.remove('selected'));
    paymentMethodCards[0].classList.add('selected');
    currentSelections.paymentMethod = "none";
    
    // Reset location
    document.getElementById('location-select').value = "";
    currentSelections.location = "";
    
    document.getElementById('sets-input').value = 20;
    numberOfSets = 20;
    
    // Clear event date
    document.getElementById('event-date-input').value = "";
    eventDate = "";
    updateEventDateDisplay();
    
    updateSummary();
}
		
		function importQuotation() {
    const importText = document.getElementById('import-textarea').value.trim();
    if (!importText) {
        alert('Please paste a quotation summary to import.');
        return;
    }
    
    try {
        // Parse the quotation text
        const lines = importText.split('\n').map(line => line.trim()).filter(line => line);
        
        // Reset to defaults first
        resetSelectionsOnly();
        
        // Parse event type
        for (const line of lines) {
            if (line.toLowerCase().includes('wedding')) {
                selectOptionCard('event-type-options', 'wedding');
                break;
            } else if (line.toLowerCase().includes('debut')) {
                selectOptionCard('event-type-options', 'debut');
                break;
            } else if (line.toLowerCase().includes('birthday')) {
                selectOptionCard('event-type-options', 'birthday');
                break;
            } else if (line.toLowerCase().includes('baptism')) {
                selectOptionCard('event-type-options', 'baptism');
                break;
            } else if (line.toLowerCase().includes('special event')) {
                selectOptionCard('event-type-options', 'special-event');
                break;
            }
        }
        
        // Parse size
        for (const line of lines) {
            if (line.toLowerCase().includes('4r') && !line.toLowerCase().includes('5r')) {
                selectOptionCard('size-options', '4r');
                break;
            } else if (line.toLowerCase().includes('5r')) {
                selectOptionCard('size-options', '5r');
                break;
            }
        }
        
        // Parse envelope
const envelopeMap = {
    'no envelope': 'no-envelope',
    'plain white': 'plain-white',
    'premium portrait colored': 'premium-portrait-colored',
    'portrait colored': 'portrait-colored',
    'transparent': 'transparent',
    'premium colored': 'premium-colored',
    'colored': 'colored',
    'gatefold': 'gatefold',
    'pocket cover': 'pocket-cover',
    'pouch cover': 'pouch-cover',
    'trifold': 'trifold',
    'vellum cover with print': 'vellum-cover-print',
    'vellum cover': 'vellum-cover'
};

let envelopeFound = false;
for (const line of lines) {
    const lowerLine = line.toLowerCase();
    
    // First check for "no envelope"
    if (lowerLine.includes('no envelope')) {
        selectOptionCard('envelope-options', 'no-envelope');
        // Reset custom envelope
        currentSelections.envelope.custom = false;
        currentSelections.envelope.color = "";
        currentSelections.envelope.texture = "";
        document.getElementById('envelope-checkbox').checked = false;
        document.getElementById('color-select').value = "";
        document.getElementById('texture-select').value = "";
        envelopeFound = true;
        break;
    }
    
    // Check for specific envelope types
    for (const [key, value] of Object.entries(envelopeMap)) {
        if (lowerLine.includes(key) && lowerLine.includes('envelope')) {
            selectOptionCard('envelope-options', value);
            
            // IMPORTANT: Store the envelope type first
            const envelopeName = document.querySelector(`#envelope-options .option-card[data-value="${value}"] .option-name`).textContent;
            currentSelections.envelope.name = envelopeName;
            
            // Parse custom envelope details from this line
            parseCustomEnvelopeDetails(line);
            
            envelopeFound = true;
            break;
        }
    }
    
    if (envelopeFound) break;
}
        
        // Helper function to parse custom envelope details
function parseCustomEnvelopeDetails(line) {
    const lineLower = line.toLowerCase();
    
    // Check if this is "No envelope" first - if so, don't enable custom
    if (lineLower.includes('no envelope')) {
        currentSelections.envelope.custom = false;
        currentSelections.envelope.color = "";
        currentSelections.envelope.texture = "";
        document.getElementById('envelope-checkbox').checked = false;
        document.getElementById('color-select').value = "";
        document.getElementById('texture-select').value = "";
        return;
    }
    
    // Start with custom envelope disabled by default
    currentSelections.envelope.custom = false;
    currentSelections.envelope.color = "";
    currentSelections.envelope.texture = "";
    
    // Check for color matches
    const colorSelect = document.getElementById('color-select');
    for (const option of colorSelect.options) {
        if (option.value && option.value !== "") {
            // Convert color to lowercase for comparison
            const colorLower = option.value.toLowerCase();
            
            // Check if this color appears in the line
            if (lineLower.includes(colorLower)) {
                currentSelections.envelope.color = option.value;
                break;
            }
            
            // Also check for partial matches (for multi-word colors)
            const colorWords = colorLower.split(' ');
            for (const word of colorWords) {
                if (word.length > 3 && lineLower.includes(word)) {
                    currentSelections.envelope.color = option.value;
                    break;
                }
            }
        }
    }
    
    // Check for texture matches
    if (lineLower.includes('matte') && !lineLower.includes('premium matte')) {
        currentSelections.envelope.texture = "Matte";
    } else if (lineLower.includes('glossy')) {
        currentSelections.envelope.texture = "Glossy";
    } else if (lineLower.includes('textured')) {
        currentSelections.envelope.texture = "Textured";
    }
    
    // Enable custom envelope checkbox if either color or texture was found
    // AND if this is not a "No envelope" selection
    if (currentSelections.envelope.color || currentSelections.envelope.texture) {
        // But only if the envelope type is not "no-envelope"
        if (currentSelections.envelope.value !== 'no-envelope') {
            currentSelections.envelope.custom = true;
            document.getElementById('envelope-checkbox').checked = true;
            document.getElementById('color-select').value = currentSelections.envelope.color;
            document.getElementById('texture-select').value = currentSelections.envelope.texture;
        }
    }
}
        
        // Parse inserts count
        for (const line of lines) {
            const insertMatch = line.match(/(\d+)\s*inserts?/i);
            if (insertMatch) {
                const insertCount = parseInt(insertMatch[1]);
                document.getElementById('inserts-slider').value = insertCount;
                document.getElementById('inserts-value').textContent = `${insertCount} insert${insertCount !== 1 ? 's' : ''}`;
                currentSelections.inserts = { value: insertCount, price: insertCount * INSERT_PRICE };
                break;
            }
        }
        
        // Parse paper type
        const paperMap = {
    'matte textured': 'matte-textured',
    'glossy textured': 'glossy-textured',
    'premium matte': 'premium-matte',
    'matte': 'matte',
    'glossy': 'glossy'
};

         for (const line of lines) {
            const lowerLine = line.toLowerCase();
        
        for (const [key, value] of Object.entries(paperMap)) {
            if (lowerLine.includes(key) && lowerLine.includes('paper')) {
                selectOptionCard('paper-options', paperMap[key]);
                break;
            }
        }
         }
        
    


        
        // Parse seal
        const sealMap = {
            'no seal': 'no-seal',
            'sticker seal': 'sticker-seal',
            'belt': 'belt',
            'wax seal with string and flower': 'wax-seal-string-flower',
            'belt with print': 'belt-print',
            'frosted belt': 'frosted-belt',
            'ribbon': 'ribbon',
            'printed tag': 'printed-tag',
            'jute string': 'jute-string',
            'wax seal with flower': 'wax-seal-flower',
            'frosted belt with print': 'frosted-belt-print',
            'frayed ribbon': 'frayed-ribbon',
            'wax seal with string': 'wax-seal-string',
            'wax seal': 'wax-seal'
        };
        
        for (const line of lines) {
            const lowerLine = line.toLowerCase();
            for (const [key, value] of Object.entries(sealMap)) {
                if (lowerLine.includes(key)) {
                    selectOptionCard('seal-options', value);
                    break;
                }
            }
        }
        
        // Parse number of sets
        for (const line of lines) {
            const setsMatch = line.match(/(\d+)\s*sets?/i);
            if (setsMatch) {
                const setsCount = parseInt(setsMatch[1]);
                document.getElementById('sets-input').value = setsCount;
                numberOfSets = setsCount;
                break;
            }
        }
        
        // Parse event date
        for (const line of lines) {
            if (line.toLowerCase().includes('event date:')) {
                const dateMatch = line.match(/Event Date:\s*(.+)/i);
                if (dateMatch) {
                    // Try to parse the date
                    const dateText = dateMatch[1].trim();
                    const dateObj = new Date(dateText);
                    if (!isNaN(dateObj.getTime())) {
                        // Format as YYYY-MM-DD for the date input
                        const year = dateObj.getFullYear();
                        const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                        const day = String(dateObj.getDate()).padStart(2, '0');
                        eventDate = `${year}-${month}-${day}`;
                        document.getElementById('event-date-input').value = eventDate;
                    }
                }
                break;
            }
        }
        
        // Parse location
        for (const line of lines) {
            if (line.toLowerCase().includes('location:')) {
                const locationMatch = line.match(/Location:\s*(.+)/i);
                if (locationMatch) {
                    const locationText = locationMatch[1].trim().toLowerCase();
                    const locationMap = {
                        'ncr': 'ncr',
                        'north luzon': 'north-luzon',
                        'central luzon': 'central-luzon',
                        'south luzon': 'south-luzon',
                        'visayas': 'visayas',
                        'mindanao': 'mindanao'
                    };
                    
                    for (const [key, value] of Object.entries(locationMap)) {
                        if (locationText.includes(key)) {
                            document.getElementById('location-select').value = value;
                            currentSelections.location = value;
                            break;
                        }
                    }
                }
                break;
            }
        }
        
        // Parse discount
        const hasDiscount = lines.some(line => 
            line.toLowerCase().includes('discount') && 
            line.toLowerCase().includes('pay for')
        );
        
        if (hasDiscount) {
            document.getElementById('discount-checkbox').checked = true;
            currentSelections.discount = true;
            
            // Try to extract discount details
            for (const line of lines) {
                if (line.toLowerCase().includes('pay for') && line.toLowerCase().includes('receive')) {
                    const payMatch = line.match(/pay for\s*(\d+)/i);
                    const receiveMatch = line.match(/receive\s*(\d+)/i);
                    if (payMatch && receiveMatch) {
                        const payFor = parseInt(payMatch[1]);
                        const receive = parseInt(receiveMatch[1]);
                        if (receive > payFor) {
                            numberOfSets = receive;
                            document.getElementById('sets-input').value = receive;
                        }
                    }
                    break;
                }
            }
        }
        
        // Parse layout type
for (const line of lines) {
    if (line.toLowerCase().includes('own layout')) {
        document.getElementById('layout-type').value = 'own-layout';
        currentSelections.layout.type = 'own-layout';
        break;
    } else if (line.toLowerCase().includes('layout fee') || 
               line.toLowerCase().includes('free layout')) {
        // If there's any mention of layout fee or free layout, assume no-layout
        document.getElementById('layout-type').value = 'no-layout';
        currentSelections.layout.type = 'no-layout';
        break;
    }
}

// Parse rush type
for (const line of lines) {
    if (line.toLowerCase().includes('rush fee')) {
        // Check if it's "own layout" rush or regular rush
        if (lines.some(l => l.toLowerCase().includes('own layout') && 
                           l.toLowerCase().includes('rush'))) {
            document.getElementById('rush-type').value = 'own-layout';
            currentSelections.rush.type = 'own-layout';
        } else {
            document.getElementById('rush-type').value = 'no-layout';
            currentSelections.rush.type = 'no-layout';
        }
        
        // Also check the rush checkbox if rush fee is mentioned
        document.getElementById('rush-checkbox').checked = true;
        currentSelections.rush.required = true;
        break;
    }
}

// Also check for layout checkbox based on layout fee or free layout
for (const line of lines) {
    if (line.toLowerCase().includes('layout fee:') || 
        line.toLowerCase().includes('free layout') ||
        line.toLowerCase().includes('own layout')) {
        document.getElementById('layout-checkbox').checked = true;
        currentSelections.layout.required = true;
        break;
    }
}
		
		// Parse payment method
        const hasDirectShipping = lines.some(line => line.toLowerCase().includes('direct shipping'));
        const hasShopeeCheckout = lines.some(line => line.toLowerCase().includes('shopee checkout'));
        
        if (hasDirectShipping && hasShopeeCheckout) {
            selectOptionCard('payment-method-options', 'none'); // Show All
        } else if (hasDirectShipping) {
            selectOptionCard('payment-method-options', 'direct-shipping');
        } else if (hasShopeeCheckout && lines.some(line => line.toLowerCase().includes('full payment'))) {
            selectOptionCard('payment-method-options', 'shopee-checkout-full');
        } else if (hasShopeeCheckout) {
            selectOptionCard('payment-method-options', 'shopee-checkout');
        }
        
        // Parse add-ons (simplified version)
        // Note: This is a basic implementation - you may need to enhance it for complex add-ons
        const addonLines = lines.filter(line => {
            const lowerLine = line.toLowerCase();
            return addonsData.some(addon => lowerLine.includes(addon.name.toLowerCase()));
        });
        
        // Clear existing add-ons
        document.querySelectorAll('.addon-checkbox').forEach(checkbox => {
            checkbox.checked = false;
        });
        document.querySelectorAll('.addon-input').forEach(input => {
            input.value = 1;
            input.disabled = true;
        });
        currentSelections.addons = {};
        
        // Process add-on lines
        addonLines.forEach(line => {
            const lowerLine = line.toLowerCase();
            
            addonsData.forEach(addon => {
                if (lowerLine.includes(addon.name.toLowerCase())) {
                    // Check for quantity in the line
                    let quantity = 1;
                    const quantityMatch = line.match(/(\d+)\s*(?:page|pages|pc|pcs)/i);
                    if (quantityMatch) {
                        quantity = parseInt(quantityMatch[1]);
                    }
                    
                    // Find and check the checkbox
                    const checkbox = document.getElementById(`addon-${addon.id}`);
                    if (checkbox) {
                        checkbox.checked = true;
                        
                        // Enable and set quantity input if exists
                        const quantityInput = document.getElementById(`qty-${addon.id}`);
                        if (quantityInput) {
                            quantityInput.disabled = false;
                            quantityInput.value = quantity;
                        }
                        
                        // Update current selections
                        currentSelections.addons[addon.id] = {
                            name: addon.name,
                            price: addon.price,
                            unit: addon.unit,
                            quantity: quantity
                        };
                    }
                }
            });
        });
        
        // Update the summary
        updateSummary();
        updateEventDateDisplay();
        updateEventTypeTitle();
        
        // Save to localStorage
        saveToLocalStorage();
        
        // Update UI controls to reflect imported values
		document.getElementById('envelope-checkbox').checked = currentSelections.envelope.custom || false;
		document.getElementById('color-select').value = currentSelections.envelope.color || "";
		document.getElementById('texture-select').value = currentSelections.envelope.texture || "";
		
		// Show success message
        alert('Quotation imported successfully!');
        
    } catch (error) {
        console.error('Error importing quotation:', error);
        alert('Error importing quotation. Please check the format and try again.');
    }
}

// Helper function to select option cards
function selectOptionCard(containerId, value) {
    const container = document.getElementById(containerId);
    const optionCards = container.querySelectorAll('.option-card');
    optionCards.forEach(card => {
        if (card.getAttribute('data-value') === value) {
            card.classList.add('selected');
            
            // Update current selections based on container type
            if (containerId === 'event-type-options') {
                const price = parseInt(card.getAttribute('data-price'));
                const name = card.querySelector('.option-name').textContent;
                currentSelections.eventType = { value: value, price: price, name: name };
            } else if (containerId === 'size-options') {
                const price = parseInt(card.getAttribute('data-price'));
                const name = card.querySelector('.option-name').textContent;
                currentSelections.size = { value: value, price: price, name: name };
            } else if (containerId === 'envelope-options') {
                const price = parseInt(card.getAttribute('data-price'));
                const name = card.querySelector('.option-name').textContent;
                currentSelections.envelope = { value: value, price: price, name: name };
            } else if (containerId === 'paper-options') {
                const price = parseInt(card.getAttribute('data-price'));
                const name = card.querySelector('.option-name').textContent;
                currentSelections.paper = { value: value, price: price, name: name };
            } else if (containerId === 'seal-options') {
                const price = parseInt(card.getAttribute('data-price'));
                const name = card.querySelector('.option-name').textContent;
                currentSelections.seal = { value: value, price: price, name: name };
            } else if (containerId === 'payment-method-options') {
                currentSelections.paymentMethod = value;
            }
        } else {
            card.classList.remove('selected');
        }
    });
}
		
		
		
		function printQuote() {
            window.print();
        }
    </script>
</body>
</html>
